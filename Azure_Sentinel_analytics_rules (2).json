{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        }
    },
    "resources": [
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/a9c1d3ee-55c3-4c7d-b3f3-0583b0b4aa1b')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/a9c1d3ee-55c3-4c7d-b3f3-0583b0b4aa1b')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Sysinternals Tools Detected in O365 (SOC Prime)",
                "description": "The sysinternals tools are bunch of small, powerful and portable windows tools for configuration, discovery within the network and at the system level. The adversary can install any of the relevant tool on the network/system to gather the information about the network, processes and other various information for malicious purposes. The rule triggered if any of the sysinternal is uploaded, downloaded or accessed on the O365 apps.\n\nCan be used for offensive perspective. Technique: T1204.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"FileUploaded\" or Operation == \"FileAccessed\" or Operation == \"FileDownloaded\") and (SourceFileName == \"AccessEnum.exe\" or SourceFileName == \"AdExplorer.exe\" or SourceFileName == \"AdInsight.exe\" or SourceFileName == \"AdRestore.exe\" or SourceFileName == \"Autologon.exe\" or SourceFileName == \"Autoruns.exe\" or SourceFileName == \"BgInfo.exe\" or SourceFileName == \"CacheSet.exe\" or SourceFileName == \"ClockRes.exe\" or SourceFileName == \"Contig.exe\" or SourceFileName == \"Coreinfo.exe\" or SourceFileName == \"Ctrl2Cap.exe\" or SourceFileName == \"DebugView.exe\" or SourceFileName == \"Desktops.exe\" or SourceFileName == \"Disk2vhd.exe\" or SourceFileName == \"DiskExt.exe\" or SourceFileName == \"DiskMon.exe\" or SourceFileName == \"DiskView.exe\" or SourceFileName == \"EFSDump.exe\" or SourceFileName == \"FindLinks.exe\" or SourceFileName == \"Handle.exe\" or SourceFileName == \"Hex2dec.exe\" or SourceFileName == \"Junction.exe\" or SourceFileName == \"LDMDump.exe\" or SourceFileName == \"ListDLLs.exe\" or SourceFileName == \"LiveKd.exe\" or SourceFileName == \"LoadOrder.exe\" or SourceFileName == \"LogonSessions.exe\" or SourceFileName == \"PipeList.exe\" or SourceFileName == \"PortMon.exe\" or SourceFileName == \"ProcDump.exe\" or SourceFileName == \"ProcMon.exe\" or SourceFileName == \"PsFile.exe\" or SourceFileName == \"PsGetSid.exe\" or SourceFileName == \"PsInfo.exe\" or SourceFileName == \"PsKill.exe\" or SourceFileName == \"PsList.exe\" or SourceFileName == \"PsLogList.exe\" or SourceFileName == \"PsLoggedOn.exe\" or SourceFileName == \"PsPasswd.exe\" or SourceFileName == \"PsPing.exe\" or SourceFileName == \"PsService.exe\" or SourceFileName == \"PsShutdown.exe\" or SourceFileName == \"PsSuspend.exe\" or SourceFileName == \"RAMMap.exe\" or SourceFileName == \"RegDelNull.exe\" or SourceFileName == \"RegJump.exe\" or SourceFileName == \"SDelete.exe\" or SourceFileName == \"ShareEnum.exe\" or SourceFileName == \"ShellRunas.exe\" or SourceFileName == \"Sigcheck.exe\" or SourceFileName == \"Streams.exe\" or SourceFileName == \"Strings.exe\" or SourceFileName == \"Sysmon.exe\" or SourceFileName == \"TCPView.exe\" or SourceFileName == \"WhoIs.exe\" or SourceFileName == \"WinObj.exe\" or SourceFileName == \"ZoomIt.exe\" or SourceFileName == \"pipelist.exe\" or SourceFileName == \"procexp.exe\" or SourceFileName == \"psexec.exe\" or SourceFileName == \"ru.exe\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "UserId_"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeId"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "RecordType"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/63ede70b-0aad-49ad-9205-d65981fc7770')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/63ede70b-0aad-49ad-9205-d65981fc7770')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "TransportRule Operations in O365 (SOC Prime)",
                "description": "The rule will trigger when it detects the adversary create transport rules (mail flow rules) in your organization. Technique: T1020.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where ((ResultStatus == \"True\") and (Operation == \"Set-TransportRule\" or Operation == \"Enable-TransportRule\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Exfiltration"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/3eff79c0-40a4-4e96-b2d1-797b8f560a7f')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/3eff79c0-40a4-4e96-b2d1-797b8f560a7f')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "User account created and deleted within 10 mins",
                "description": "Identifies when a user account is created and then deleted within 10 minutes. This can be an indication of compromise and\nan adversary attempting to hide in the noise.",
                "severity": "Medium",
                "enabled": true,
                "query": "let timeframe = 1d;\nlet spanoftime = 10m;\nlet threshold = 0;\nSecurityEvent \n| where TimeGenerated > ago(2*timeframe) \n// A user account was created\n| where EventID == 4720\n| where AccountType =~ \"User\"\n| project creationTime = TimeGenerated, CreateEventID = EventID, Activity, Computer, TargetUserName, UserPrincipalName, \nAccountUsedToCreate = SubjectUserName, TargetSid, SubjectUserSid \n| join kind= inner (\n  SecurityEvent\n  | where TimeGenerated > ago(timeframe) \n  // A user account was deleted \n  | where EventID == 4726\n| where AccountType == \"User\"\n| project deletionTime = TimeGenerated, DeleteEventID = EventID, Activity, Computer, TargetUserName, UserPrincipalName, \nAccountUsedToDelete = SubjectUserName, TargetSid, SubjectUserSid \n) on Computer, TargetUserName\n| where deletionTime - creationTime < spanoftime\n| extend TimeDelta = deletionTime - creationTime\n| where tolong(TimeDelta) >= threshold\n| project TimeDelta, creationTime, CreateEventID, Computer, TargetUserName, UserPrincipalName, AccountUsedToCreate, \ndeletionTime, DeleteEventID, AccountUsedToDelete\n| extend timestamp = creationTime, AccountCustomEntity = AccountUsedToCreate, HostCustomEntity = Computer",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Persistence",
                    "PrivilegeEscalation"
                ],
                "alertRuleTemplateName": "4b93c5af-d20b-4236-b696-a28b8c51407f",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "AccountUsedToCreate"
                            },
                            {
                                "identifier": "DisplayName",
                                "columnName": "AccountUsedToDelete"
                            },
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserPrincipalName"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "CreateEventID"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "DeleteEventID"
                            },
                            {
                                "identifier": "CreationTimeUtc",
                                "columnName": "creationTime"
                            }
                        ]
                    },
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "AadUserId",
                                "columnName": "TargetUserName"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/50ad372c-9203-4ab2-98d1-de05736bb355')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/50ad372c-9203-4ab2-98d1-de05736bb355')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "User account enabled and disabled within 10 mins",
                "description": "Identifies when a user account is enabled and then disabled within 10 minutes. This can be an indication of compromise and\nan adversary attempting to hide in the noise.",
                "severity": "Medium",
                "enabled": true,
                "query": "let timeframe = 1d;\nlet spanoftime = 10m;\nlet threshold = 0;\nSecurityEvent \n| where TimeGenerated > ago(2*timeframe) \n// A user account was enabled\n| where EventID == 4722\n| where AccountType =~ \"User\"\n| project creationTime = TimeGenerated, CreateEventID = EventID, Activity, Computer, TargetUserName, UserPrincipalName, \nAccountUsedToCreate = SubjectUserName, TargetSid, SubjectUserSid \n| join kind= inner (\n  SecurityEvent\n  | where TimeGenerated > ago(timeframe) \n  // A user account was disabled \n  | where EventID == 4725\n| where AccountType == \"User\"\n| project deletionTime = TimeGenerated, DeleteEventID = EventID, Activity, Computer, TargetUserName, UserPrincipalName, \nAccountUsedToDelete = SubjectUserName, TargetSid, SubjectUserSid \n) on Computer, TargetUserName\n| where deletionTime - creationTime < spanoftime\n| extend TimeDelta = deletionTime - creationTime\n| where tolong(TimeDelta) >= threshold\n| project TimeDelta, creationTime, CreateEventID, Computer, TargetUserName, UserPrincipalName, AccountUsedToCreate, \ndeletionTime, DeleteEventID, AccountUsedToDelete",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Persistence",
                    "PrivilegeEscalation"
                ],
                "alertRuleTemplateName": "3d023f64-8225-41a2-9570-2bd7c2c4535e",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "AadUserId",
                                "columnName": "AccountUsedToCreate"
                            },
                            {
                                "identifier": "DisplayName",
                                "columnName": "AccountUsedToDelete"
                            },
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserPrincipalName"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "CreateEventID"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "DeleteEventID"
                            },
                            {
                                "identifier": "CreationTimeUtc",
                                "columnName": "creationTime"
                            }
                        ]
                    },
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "AadUserId",
                                "columnName": "TargetUserName"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/53485956-9e33-45eb-880c-ec533cc9a186')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/53485956-9e33-45eb-880c-ec533cc9a186')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "User Account Was Locked in O365 (SOC Prime)",
                "description": "The adversary may use brute force technique to try to gain access to the account. The adversary can try to obtain access with stolen password hashes or guessing the password using repetition or tools. The rule is triggered when the adversary has attempted failed logins and the ID is now locked in O365 app. For more information, please visit this link: https://attack.mitre.org/techniques/T1110/",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity \r\n| where Operation == \"UserLoginFailed\" \r\n| where * contains \"IdsLocked\" \r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "AadUserId",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/b2ee6c52-d60f-4cc2-872c-9432959fabc4')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/b2ee6c52-d60f-4cc2-872c-9432959fabc4')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Wipe command executed to delete the data from disk in Linux",
                "description": "This rule is triggered when the adversary tried to execute the command to wipe the disk in the Linux Endpoint. The adversary may execute this command to wipe or corrupt data to interrupt the conducive working of the organization.\nFor more information, please visit this link: https://attack.mitre.org/techniques/T1561/",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where SeverityLevel == 'notice'\r\n| where  SyslogMessage contains 'wipe'\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Impact"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/490feacf-44e1-4de0-bb6e-892500108e0e')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/490feacf-44e1-4de0-bb6e-892500108e0e')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "MLBehaviorAnalytics",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "enabled": true,
                "alertRuleTemplateName": "fa118b98-de46-4e94-87f9-8e6d5060b60b"
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/b262d967-b7b1-48ba-ae57-996a1912211a')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/b262d967-b7b1-48ba-ae57-996a1912211a')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "ThreatIntelligence",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "enabled": true,
                "alertRuleTemplateName": "0dd422ee-e6af-4204-b219-f59ac172e4c6",
                "description": "This rule generates an alert when a Microsoft Threat Intelligence Indicator gets matched with your event logs. The alerts are very high fidelity and are turned ON by default. \n\nNote : It is advised to turn off any custom alert rules which match the threat intelligence indicators with the same event logs matched by this analytics to prevent duplicate alerts.",
                "displayName": "(Preview) Microsoft Threat Intelligence Analytics",
                "severity": "Medium",
                "tactics": [
                    "Persistence",
                    "LateralMovement"
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/23337ca2-0e0b-4ce4-afb2-74644836c7e0')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/23337ca2-0e0b-4ce4-afb2-74644836c7e0')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": " Adversaries abuse of RC scripts in Linux",
                "description": "Technique: T1037.004 \nAdversaries may establish persistence by modifying RC scripts which are executed during a Unix-like system’s startup. Adversaries can establish persistence by adding a malicious binary path or shell commands to rc.local and rc.common.",
                "severity": "Low",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where ProcessName == 'sudo' \r\n| where SyslogMessage contains \"rc.common\" or SyslogMessage contains \"rc.local\"\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "PrivilegeEscalation"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ProcessName"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/4ab0872d-f6ef-4af7-937f-32d8774f294e')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/4ab0872d-f6ef-4af7-937f-32d8774f294e')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Account creation detection in Linux",
                "description": "This rule is triggered when the rule detected the account creation in the Linux endpoint. Whenever “adduser” cmdlet is executed in the Linux system this rule will detect it because adversaries may create an account to maintain access to victim systems with a sufficient level of access. (Techniques: T1136.001)",
                "severity": "Low",
                "enabled": true,
                "query": "Syslog \r\n| where ProcessName contains \"useradd\" and Facility contains \"authpriv\" | where ingestion_time() >= ago(12m)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Persistence"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "ProcessName"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/fad5c720-3f2b-468d-8ce1-8b3f401d90c1')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/fad5c720-3f2b-468d-8ce1-8b3f401d90c1')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Account manipulation in Linux",
                "description": "This rule is triggered when the rule detected the crypto-miners tools downloaded in the Linux endpoint. This is typically a very stealthy malware that farms the resources on a system (computers, smartphones, and other electronic devices connected to the internet) to generate revenue for the cybercriminals controlling it.",
                "severity": "Low",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains '/etc/passwd' or SyslogMessage contains '/etc/group' or SyslogMessage contains '/etc/shadow' or SyslogMessage contains '/etc/login.defs'\r\nor SyslogMessage contains '/etc/gshadow' or SyslogMessage contains '/etc/login.defs' | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Persistence"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/450aced4-48ce-4232-8819-2026f5e0da18')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/450aced4-48ce-4232-8819-2026f5e0da18')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Crypto currency miners EXECVE in Linux",
                "description": "This rule is triggered when the rule detected the crypto-miners malicious tools downloaded in the Linux endpoint. This is typically a very stealthy tools that farms the resources on a system (computers, smartphones, and other electronic devices connected to the internet) to generate revenue for the cybercriminals controlling it.",
                "severity": "Low",
                "enabled": true,
                "query": "Syslog\r\n| where * contains \"wget\"or * contains \"curl\" and\r\n// Find command lines featuring known crypto currency miner names\r\n * contains \"nicehashminer\" or * contains \"ethminer\" or * contains \"equihash\" or * contains \"NsCpuCNMiner64\" or * contains \"minergate\" or * contains \"minerd\" or * contains \"cpuminer\" or * contains \"xmr-stak-cpu\" or * contains \"xmrig\" or * contains \"stratum+tcp\" or * contains \"cryptonight\" or * contains \"monero\" or * contains \"oceanhole\" or * contains \"dockerminer\" or * contains \"xmrdemo\"  or * contains \"docker\" | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f7cddf72-8e68-4065-a1c2-aacfc4e6b4cb')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f7cddf72-8e68-4065-a1c2-aacfc4e6b4cb')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Cryptominer Tools Detected in an O365 App (SOC Prime)",
                "description": "This rule will trigger when it detects known cryptomining tools in O365 apps. like  bitcoin, btc, bitmoose. The crypto tool uses the system resources if they are contacted by any cryptomining tool that will expose to the external threats.  Technique: T1204.",
                "severity": "Low",
                "enabled": true,
                "query": "OfficeActivity \r\n| where ((Operation == \"FileUploaded\" or Operation == \"FileAccessed\" or Operation == \"FileDownloaded\") and (SourceFileName contains \"miner\" or SourceFileName contains \"auroracoin\" or SourceFileName contains \"bitcoin\" or SourceFileName contains \"bitmoose\" or SourceFileName contains \"btc.exe\" or SourceFileName contains \"minerd\")) \r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "SourceSystem"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeId"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "OfficeObjectId"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/2ab923c0-edab-4390-b14b-dd41d064cea1')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/2ab923c0-edab-4390-b14b-dd41d064cea1')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Editing scheduled task through Crontab in Linux",
                "description": "An adversary may use cron in Linux environments to execute programs at system startup or on a scheduled basis for persistence. cron can also be abused to conduct remote execution as part of lateral movement and/or to run a process under the context of a specified account.\nThe rule is triggered when syslog contains any process which uses cron/crontab utility and it provides user and action information.  \nFor more information, please visit this link: https://attack.mitre.org/techniques/T1053/003/ \n\n",
                "severity": "Low",
                "enabled": true,
                "query": "// Pull messages from Syslog-cron logs where the process is crontab and the severity level is \"info\". Extract the User and Action information from the SyslogMessage\r\nSyslog \r\n| where Facility =~ \"cron\" \r\n| where ProcessName =~ \"crontab\" \r\n| where SeverityLevel =~ \"info\" \r\n| project TimeGenerated, Computer, SeverityLevel, ProcessName, ProcessID, SyslogMessage, HostIP\r\n| parse SyslogMessage with * \"(\" user  \") \" Action \" (\" *\r\n// Only look for messages that contain edit or replace\r\n| where Action contains \"EDIT\" or Action contains \"REPLACE\"\r\n//| summarize all the actions into a single set based on 10 minute time intervals\r\n| summarize makeset(Action) by bin(TimeGenerated, 10m), Computer, user  \r\n| project\r\n    EventTime10MinInterval = TimeGenerated,\r\n    Computer,\r\n    user,\r\n    ListOfActions = set_Action \r\n| order by Computer asc nulls last, EventTime10MinInterval asc\r\n| extend\r\n    timestamp = EventTime10MinInterval,\r\n    AccountCustomEntity = user,\r\n    HostCustomEntity = Computer",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "AccountCustomEntity"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "user"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "HostCustomEntity"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ListOfActions"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/37e4e631-f510-4ea4-821e-873506566a35')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/37e4e631-f510-4ea4-821e-873506566a35')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Multiple Password Reset by user",
                "description": "This query will determine multiple password resets by user across multiple data sources. \nAccount manipulation including password reset may aid adversaries in maintaining access to credentials \nand certain permission levels within an environment.",
                "severity": "Low",
                "enabled": true,
                "query": "let PerUserThreshold = 20;\nlet TotalThreshold = 100;\nlet action = dynamic([\"change\", \"changed\", \"reset\"]);\nlet pWord = dynamic([\"password\", \"credentials\"]);\nlet PasswordResetMultiDataSource =\n(union isfuzzy=true\n(//Password reset events\n//4723: An attempt was made to change an account's password\n//4724: An attempt was made to reset an accounts password\nSecurityEvent\n| where EventID in (\"4723\",\"4724\")\n| project TimeGenerated, Computer, AccountType, Account, Type, TargetUserName),\n(//Azure Active Directory Password reset events\nAuditLogs\n| where OperationName has_any (pWord) and OperationName has_any (action) and Result =~ \"success\"\n| extend AccountType = tostring(TargetResources[0].type), Account = tostring(TargetResources[0].userPrincipalName), \nTargetUserName = tolower(tostring(TargetResources[0].displayName))\n| project TimeGenerated, AccountType, Account, Computer = \"\", Type),\n(//OfficeActive ActiveDirectory Password reset events\nOfficeActivity\n| where OfficeWorkload == \"AzureActiveDirectory\" \n| where (ExtendedProperties has_any (pWord) or ModifiedProperties has_any (pWord)) and (ExtendedProperties has_any (action) or ModifiedProperties has_any (action))\n| extend AccountType = UserType, Account = OfficeObjectId \n| project TimeGenerated, AccountType, Account, Type, Computer = \"\"),\n(// Unix syslog password reset events\nSyslog\n| where Facility in (\"auth\",\"authpriv\")\n| where SyslogMessage has_any (pWord) and SyslogMessage has_any (action)\n| extend AccountType = iif(SyslogMessage contains \"root\", \"Root\", \"Non-Root\")\n| where SyslogMessage matches regex \".*password changed for.*\"\n| parse SyslogMessage with * \"password changed for\" Account\n| project TimeGenerated, AccountType, Account, Computer = HostName, Type)\n);\nlet pwrmd = PasswordResetMultiDataSource\n| project TimeGenerated, Computer, AccountType, Account, Type, TargetUserName;\n(union isfuzzy=true  \n(pwrmd\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), Computerlist = make_set(Computer, 25), AccountType = make_set(AccountType, 25), Computer = arg_max(Computer , TimeGenerated), TargetUserList = make_set(TargetUserName, 25), TargetUserName = arg_max(TargetUserName, TimeGenerated), Total=count() by Account, Type\n| where Total > PerUserThreshold\n| extend ResetPivot = \"PerUserReset\"),  \n(pwrmd\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), ComputerList = make_set(Computer, 25), AccountList = make_set(Account, 25), AccountType = make_set(AccountType, 25), Account = arg_max(Account, TimeGenerated), Computer = arg_max(Computer , TimeGenerated), TargetUserList = make_set(TargetUserName, 25), TargetUserName = arg_max(TargetUserName, TimeGenerated), Total=count() by Type\n| where Total > TotalThreshold\n| extend ResetPivot = \"TotalUserReset\")\n)\n| extend timestamp = StartTimeUtc, AccountCustomEntity = Account, HostCustomEntity = Computer",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "InitialAccess",
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": "0b9ae89d-8cad-461c-808f-0494f70ad5c4",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "AccountCustomEntity"
                            },
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "Account"
                            },
                            {
                                "identifier": "AadUserId",
                                "columnName": "TargetUserName"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "Type"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Total"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResetPivot"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostCustomEntity"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "Computer"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/bf9ba662-0fb7-43ff-90ee-6636538fe428')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/bf9ba662-0fb7-43ff-90ee-6636538fe428')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Network Sniffing in Linux",
                "description": "The rule triggered when it detects the network sniffing activity in Linux environment using tcpdump and sniffing on ens33 which is logical name for Network Internet card.\nAdversaries may sniff network traffic to capture information about an environment, including authentication material passed over the network. Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.\nReferences: https://attack.mitre.org/techniques/T1040/",
                "severity": "Low",
                "enabled": true,
                "query": "Syslog\r\n| where Facility contains \"authpriv\"\r\n| where SyslogMessage contains \"ens33\"\r\n| where SyslogMessage contains \"tcpdump\"\r\n| where ProcessName == \"sudo\" and SeverityLevel == \"notice\"\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/6d130b2f-6b58-44c0-a99c-f3951696bcea')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/6d130b2f-6b58-44c0-a99c-f3951696bcea')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "New user created and added to the built-in administrators group",
                "description": "Identifies when a user account was created and then added to the builtin Administrators group in the same day.\nThis should be monitored closely and all additions reviewed.",
                "severity": "Low",
                "enabled": true,
                "query": "SecurityEvent\n| where EventID == 4720\n| where AccountType == \"User\"\n| project CreatedUserTime = TimeGenerated, CreatedUserEventID = EventID, CreatedUserActivity = Activity, Computer = toupper(Computer), \nCreatedUser = tolower(TargetAccount), CreatedUserSid = TargetSid, AccountUsedToCreateUser = strcat(SubjectAccount), SidofAccountUsedToCreateUser = SubjectUserSid\n| join (\nSecurityEvent \n| where AccountType == \"User\"\n// 4732 - A member was added to a security-enabled local group\n| where EventID == 4732\n//TargetSid is the builin Admins group: S-1-5-32-544\n| where TargetSid == \"S-1-5-32-544\"\n| project GroupAddTime = TimeGenerated, GroupAddEventID = EventID, GroupAddActivity = Activity, Computer = toupper(Computer), GroupName = tolower(TargetAccount), \nGroupSid = TargetSid, AccountThatAddedUser = SubjectAccount, SIDofAccountThatAddedUser = SubjectUserSid, CreatedUserSid = MemberSid\n)\non CreatedUserSid\n//Create User first, then the add to the group.\n| project Computer, CreatedUserTime, CreatedUserEventID, CreatedUserActivity, CreatedUser, CreatedUserSid, GroupAddTime, GroupAddEventID, \nGroupAddActivity, AccountUsedToCreateUser, GroupName, GroupSid, AccountThatAddedUser, SIDofAccountThatAddedUser \n| extend timestamp = CreatedUserTime, AccountCustomEntity = CreatedUser, HostCustomEntity = Computer",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Persistence",
                    "PrivilegeEscalation"
                ],
                "alertRuleTemplateName": "aa1eff90-29d4-49dc-a3ea-b65199f516db",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "AccountUsedToCreateUser"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "GroupName"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "GroupAddActivity"
                            },
                            {
                                "identifier": "AzureID",
                                "columnName": "GroupAddEventID"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "CreatedUser"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "CreatedUserActivity"
                            },
                            {
                                "identifier": "AzureID",
                                "columnName": "CreatedUserEventID"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "AccountCustomEntity"
                            },
                            {
                                "identifier": "CreationTimeUtc",
                                "columnName": "timestamp"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/ae9c9589-a9e7-44b9-9bfb-e4935ba0e024')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/ae9c9589-a9e7-44b9-9bfb-e4935ba0e024')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Password Change Failed in O365 App (SOC Prime)",
                "description": "The adversary may use brute force technique to try to gain access to the account. The adversary can try to obtain access with stolen password hashes or guessing the password using repetition or tools. The rule is triggered when the adversary attempts failed change password multiple times in O365 app. For more information, please visit this link: https://attack.mitre.org/techniques/T1110/",
                "severity": "Low",
                "enabled": true,
                "query": "OfficeActivity \r\n| where ((Operation == \"Change user password\") and (ResultStatus == \"Failure\")) \r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl_"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/0f1bffb7-3a47-4678-abaa-6b5c344e52f4')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/0f1bffb7-3a47-4678-abaa-6b5c344e52f4')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Password Policy Discovery in Linux",
                "description": "This rule is triggered when the user tried to execute the command on the Linux endpoint to get the password policy. With the help of this, the adversary gets information about the password complexity. Password policies for networks are a way to enforce complex passwords that are difficult to guess or crack through Brute Force.",
                "severity": "Low",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where SeverityLevel == 'notice'\r\n| where SyslogMessage contains 'cat /etc/pam.d/common-password'\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Discovery"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/64ede046-1c12-4211-89b0-a0076ab6fb13')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/64ede046-1c12-4211-89b0-a0076ab6fb13')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Permission Groups Discovery command executed in Linux",
                "description": "This rule is triggered when the adversary tried to execute the command to get the information of all the groups in the Linux Endpoint. Adversaries may attempt to find group and permission settings. This information helps the adversary to get all the user accounts in the group, memberships, and elevated permissions\nFor more information, please visit this link: https://attack.mitre.org/techniques/T1069/",
                "severity": "Low",
                "enabled": true,
                "query": "Syslog\r\n| where SeverityLevel == 'notice'\r\n| where Facility == 'authpriv'\r\n| where SyslogMessage contains 'groups'\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Discovery"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/cb2c6960-3048-4733-b1d1-673b4e0ea78c')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/cb2c6960-3048-4733-b1d1-673b4e0ea78c')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Rare process running on a Linux host",
                "description": "Looks for rare processes that are running on Linux hosts. Looks for process seen less than 14 times in last 7 days, or observed rate is less than 1% of of the average for the environment and fewer than 100.",
                "severity": "Low",
                "enabled": true,
                "query": "let starttime = todatetime('{{StartTimeISO}}');\r\nlet endtime = todatetime('{{EndTimeISO}}');\r\nlet lookback = starttime - 14d;\r\nlet count_threshold = 100;\r\nlet perc_threshold = 0.01;\r\nlet host_threshold = 14;\r\nlet basic=materialize(\r\n    Syslog\r\n    | where TimeGenerated >= lookback\r\n    | summarize FullCount = count()\r\n        , Count= countif(TimeGenerated between (starttime .. endtime))\r\n        , min_TimeGenerated=min(TimeGenerated)\r\n        , max_TimeGenerated=max(TimeGenerated)\r\n        by Computer, ProcessName\r\n    | where Count > 0 and Count < count_threshold);\r\nlet basic_avg = basic\r\n    | summarize Avg = avg(FullCount) by ProcessName;\r\nbasic\r\n| project-away FullCount\r\n| join kind=inner\r\n    basic_avg\r\n    on ProcessName\r\n| project-away ProcessName1\r\n| where Count < host_threshold or (Count <= Avg * perc_threshold and Count < count_threshold)\r\n| extend HostCustomEntity=Computer\r\n",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostCustomEntity"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "ProcessName"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Count"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/b20c6c5f-b64c-43d1-bc82-9c6604bcedef')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/b20c6c5f-b64c-43d1-bc82-9c6604bcedef')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Weak executable files in Linux",
                "description": "Technique: T1574 - Services file permission weakness\nAdversaries may execute their own malicious payloads by hijacking the binaries used by services.\n",
                "severity": "Low",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where ProcessName == 'sudo' \r\n| where SyslogMessage contains \"chmod\" and SyslogMessage contains \"perm\"\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "PrivilegeEscalation"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f978a25e-94b3-4a1f-9c4c-80863e3f1b57')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f978a25e-94b3-4a1f-9c4c-80863e3f1b57')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Capture the desktop screenshot in Linux ",
                "description": "Technique: T1113 - Capture Linux full desktop screenshot using import command.\nAdversaries may attempt to take screen captures of the desktop to gather information over the course of an operation. Screen capturing functionality may be included as a feature of a remote access tool used in post-compromise operations.",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"import\"\r\n| where ProcessName == \"sudo\"\r\n| where Facility == \"authpriv\"\r\n| where Type == \"Syslog\"\r\n| where SeverityLevel == \"notice\"\r\n| where ingestion_time() >= ago(12h) ",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Collection"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ProcessName"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/d269cfb7-6012-4f9a-bba6-a1e7f2beb597')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/d269cfb7-6012-4f9a-bba6-a1e7f2beb597')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Failed logon attempts in authpriv in Linux",
                "description": "Adversary tries to brute force login attempts to access the Linux endpoint. \nThe rule is triggered when logon attempts is 15 or more. It Identifies failed logon attempts from wrong/ non-existing username in Syslog authpriv logs. If there are many hits, especially from outside your network, it could indicate a brute force attack. \nFor more information, please visit this link: https://attack.mitre.org/techniques/T1110/\n",
                "severity": "Informational",
                "enabled": true,
                "query": "let threshold = 15;\n// Below pulls messages from syslog-authpriv logs where there was an authentication failure with an unknown user.\n// IP address of system attempting logon is also extracted from the SyslogMessage field. Some of these messages\n// are aggregated.\nlet authfail = Syslog\n| where Facility =~ \"authpriv\"   // looks at authpriv messages\n| where SyslogMessage contains \"authentication failure\" and SyslogMessage contains \" uid=0\"\n| parse SyslogMessage with * \"rhost=\" ExternalIP\n| project TimeGenerated, Computer, ProcessName, HostIP, ExternalIP, ProcessID;  \n// Below pulls messages from syslog-authpriv logs that show each instance an unknown user tried to logon. \nlet userfail = Syslog \n| where Facility =~ \"authpriv\" \n| where SyslogMessage contains \"user unknown\"\n| project TimeGenerated, Computer, HostIP, ProcessID;\n// Join the two log messages above\nlet userauthfail = authfail | join (userfail) on Computer, HostIP, ProcessID\n| project TimeGenerated, Computer, HostIP, ExternalIP, ProcessID ;\n// Extract the EventTime of the first logon attempt\nlet firstfail = userauthfail\n| summarize arg_min(TimeGenerated, *) by Computer, ExternalIP\n| project Computer, ExternalIP, FirstLogonAttempt = TimeGenerated;\n// Extract the EventTime of the last logon attempt\nlet lastfail = userauthfail\n| summarize arg_max(TimeGenerated, *) by Computer, ExternalIP\n| project Computer, ExternalIP, LatestLogonAttempt = TimeGenerated;\n// Join first and last logon attempt data and calculate the time between them (AttemptPeriodLength).\nlet faildates = firstfail | join (lastfail) on Computer, ExternalIP\n| project ExternalIP, Computer, FirstLogonAttempt, LatestLogonAttempt, TimeBetweenLogonAttempts = LatestLogonAttempt - FirstLogonAttempt;\n// Count the number of failed logon attempts by External IP and internal machine\nlet totalfails = userauthfail\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), TotalLogonAttempts = count() by ExternalIP, Computer, HostIP\n| project StartTimeUtc, EndTimeUtc, ExternalIP, Computer, HostIP, TotalLogonAttempts;\n// Combine total attempts with timing data from above\nlet finalfails = totalfails | join (faildates) on Computer, ExternalIP\n| project StartTimeUtc, EndTimeUtc, SourceAddress = ExternalIP, DestinationHost = Computer, DestinationIP = HostIP, TotalLogonAttempts, FirstLogonAttempt, LatestLogonAttempt, TimeBetweenLogonAttempts\n| order by DestinationHost asc nulls last;\nfinalfails \n| where TotalLogonAttempts >= threshold\n| extend timestamp = StartTimeUtc, HostCustomEntity = DestinationHost, IPCustomEntity = DestinationIP",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": "e7ec9fa6-e7f7-41ed-a34b-b956837a3ee6",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostCustomEntity"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "DestinationHost"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "IPCustomEntity"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "TotalLogonAttempts"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/3c91233b-d586-4c06-a9fd-6177bdf34ae2')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/3c91233b-d586-4c06-a9fd-6177bdf34ae2')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Find user process discovery in the Linux",
                "description": "This rule is triggered when the rule is detected when the process discovery command is executed in the Linux endpoint. Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network.\nFor more information, please visit this link: https://attack.mitre.org/techniques/T1057/",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where SeverityLevel  == 'notice'\r\n| where SyslogMessage contains 'ps aux'\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Discovery"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/b5725c8f-1d7e-4440-811e-c51b689c69c9')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/b5725c8f-1d7e-4440-811e-c51b689c69c9')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Identify the active user in linux",
                "description": "This rule is triggered when the \"whoami\" cmdlet is executed in the Linux Endpoint. This methodology is used by the adversaries to get the information of currently logged-in users, set of users that commonly uses a system.",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where SeverityLevel == 'notice'\r\n| where SyslogMessage contains 'whoami'\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Discovery"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessName"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/4eab6a9d-30e6-4c52-bbbd-ef24e6647f94')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/4eab6a9d-30e6-4c52-bbbd-ef24e6647f94')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Ingress Tool Transfer - Rsync Remote File Copy in Linux",
                "description": "The rule will trigger when adversary is using rsync to share file remotely.\nRsync is a utility for efficiently transferring and synchronizing files between a computer and an external hard drive and across networked computers by comparing the modification times and sizes of files.\nAdversaries may transfer tools or other files from an external system into a compromised environment. Files may be copied from an external adversary controlled system through the command and control channel to bring tools into the victim network or through alternate protocols with another tool such as FTP. Files can also be copied over on Mac and Linux with native tools like scp, rsync, and sftp. References https://attack.mitre.org/techniques/T1105/",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"rsync\" and SyslogMessage contains \"/usr/bin/rsync\"\r\n| where Facility contains \"authpriv\"\r\n| where Type contains \"Syslog\"\r\n| where SourceSystem contains \"Linux\"\r\n| project SourceSystem, HostIP, HostName, Facility, SyslogMessage, Type, EventTime\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CommandAndControl"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/2c5f3431-2774-406e-ac82-5387db62b267')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/2c5f3431-2774-406e-ac82-5387db62b267')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Ingress Tool Transfer - Scp Remote File Copy in Linux",
                "description": "The rule will trigger when adversary is using Scp to share file remotely. SCP is a means of securely transferring computer files between a local host and a remote host or between two remote hosts.\nAdversaries may transfer tools or other files from an external system into a compromised environment. Files may be copied from an external adversary controlled system through the command and control channel to bring tools into the victim network or through alternate protocols with another tool such as FTP. Files can also be copied over on Mac and Linux with native tools like scp, rsync, and sftp.\nReferences https://attack.mitre.org/techniques/T1105/",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"scp\" and SyslogMessage contains \"/usr/bin/scp\"\r\n| where Facility contains \"authpriv\"\r\n| where Type contains \"Syslog\"\r\n| where SourceSystem contains \"Linux\"\r\n| project SourceSystem, HostIP, HostName, Facility, SyslogMessage, Type, EventTime\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CommandAndControl"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f5379533-8720-4c08-ad7d-55f1e66374ff')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f5379533-8720-4c08-ad7d-55f1e66374ff')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Ingress Tool Transfer - SFTP Remote File Copy in Linux",
                "description": "The rule will trigger when adversary is using SFTP to share file remotely.SFTP is a network protocol that provides file access, file transfer, and file management over any reliable data stream.\nAdversaries may transfer tools or other files from an external system into a compromised environment. Files may be copied from an external adversary controlled system through the command and control channel to bring tools into the victim network or through alternate protocols with another tool such as FTP. Files can also be copied over on Mac and Linux with native tools like scp, rsync, and sftp.\nhttps://attack.mitre.org/techniques/T1105/",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"sftp\" and SyslogMessage contains \"/usr/bin/sftp\"\r\n| where Facility contains \"authpriv\"\r\n| where Type contains \"Syslog\"\r\n| where SourceSystem contains \"Linux\"\r\n| project SourceSystem, HostIP, HostName, Facility, SyslogMessage, Type, EventTime\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CommandAndControl"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/61adec85-33d9-48b0-b17f-0ce0d1d5d8a8')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/61adec85-33d9-48b0-b17f-0ce0d1d5d8a8')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Linux Hardware Addition (USB Plugged IN/OUT )",
                "description": "The rule is triggered whenever the adversary plugin’s the usb to the Linux device. The adversary use the hardware and get all the data from the devices.\nAdversaries may introduce computer accessories, computers, or networking hardware into a system or network that can be used as a vector to gain access. While public references of usage by APT groups are scarce, many penetration testers leverage hardware additions for initial access.\nhttps://attack.mitre.org/techniques/T1200/",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where * contains \"usb\" \r\n| where SeverityLevel contains \"info\" and ProcessName == \"kernel\"\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "InitialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/0c56831f-253a-4b69-bce2-4c2f337a1749')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/0c56831f-253a-4b69-bce2-4c2f337a1749')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Overwrite file with dd command in Linux",
                "description": "This rule is triggered when the adversary tried to execute the command \"dd\" which overwrites or deletes the files from the Linux Endpoint. With this, the deleted or overwritten files are not recoverable. \nTechnique: T1485 - Data Destruction",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where ProcessName == 'sudo' \r\n| where SyslogMessage contains \"dd\"\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Impact"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ProcessName"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/3e27b18c-7dd3-47ed-a5c3-093b528af881')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/3e27b18c-7dd3-47ed-a5c3-093b528af881')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Parse SSH config in Linux",
                "description": "Technique: T1005 - Data from Local system.\nAdversaries may search local system sources, such as file systems or local databases, to find files of interest and sensitive data prior to Exfiltration. Search for valid SSH commands in the config file.\n",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where ProcessName == 'sudo' \r\n| where SyslogMessage contains \"stormssh\"\r\n| where ingestion_time() >= ago(12h) ",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Collection"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f106e132-4437-42e2-9117-399d2a709657')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f106e132-4437-42e2-9117-399d2a709657')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "SSH Login Attempts in Linux",
                "description": "Adversaries may use Valid Accounts to log into remote machines using Secure Shell (SSH). The adversary may then perform actions as the logged-on user.\nReferences: https://attack.mitre.org/techniques/T1021/004/",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage startswith \"Failed Password\"\r\n| extend User = extract(\"for(?s)(.*)from\",1,SyslogMessage)\r\n| extend IPaddr = extract(\"(([0-9]{1,3})\\\\.([0-9]{1,3})\\\\.([0-9]{1,3})\\\\.(([0-9]{1,3})))\",1,SyslogMessage) \r\n| project HostName, SyslogMessage, EventTime, IPaddr, User\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "InitialAccess",
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "User"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "IPaddr"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/df1859fd-dc27-4074-8b9b-3da82af43c6a')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/df1859fd-dc27-4074-8b9b-3da82af43c6a')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "System Network Connections Discovery in Linux",
                "description": "This rule is triggered when the user tried to execute the command, which discovers all the active connections of the Linux endpoint. With the help of this, adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network.\nFor more information, please visit this link: https://attack.mitre.org/techniques/T1049/",
                "severity": "Informational",
                "enabled": true,
                "query": "Syslog\r\n| where Facility == 'authpriv'\r\n| where SeverityLevel == 'notice'\r\n| where  SyslogMessage contains 'netstat' or  SyslogMessage contains 'sudo ss'\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "Discovery"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/42beb645-60c6-46a0-a917-516d48bb0a43')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/42beb645-60c6-46a0-a917-516d48bb0a43')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "System reboot/shutdown multiple times in Linux",
                "description": "This rule is triggered when the adversary tried to execute the shutdown, halt, and reboot the system in the Linux Endpoint. This is destruction to the infrastructure because this introduced downtime in the environment which cause a loss in the organization.\nTechnique: T1529 - System Shutdown/Reboot",
                "severity": "Informational",
                "enabled": true,
                "query": "// The threshold should be limited and time be also limited. \r\n//let PerUserThreshold = 5;\r\n//let TotalThreshold = 10;\r\nSyslog\r\n| where Facility == 'authpriv'\r\n| where ProcessName == 'sudo' \r\n| where SyslogMessage contains \"halt\" or SyslogMessage contains \"poweroff\" or SyslogMessage contains \"reboot\" or SyslogMessage contains \"shutdown\"\r\n// For extracting user information form Syslog Message\r\n//| extend User = extract(\"for(?s)(.*)from\",1,SyslogMessage)\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Impact"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ProcessName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f209187f-1d17-4431-94af-c141bf5f23db')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f209187f-1d17-4431-94af-c141bf5f23db')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "f209187f-1d17-4431-94af-c141bf5f23db",
                "displayName": "(Preview) Anomalous Account Creation",
                "enabled": true,
                "tactics": [
                    "Persistence"
                ],
                "anomalyVersion": "1.0.1",
                "techniques": [
                    "T1136"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0",
                            "maximum": "1",
                            "value": "0.4",
                            "name": "Anomaly score threshold",
                            "description": "Generate an anomaly when the anomaly score is greater than the chosen value.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/2d3e33c6-d8e6-4b51-92d6-dbe8bd9efb05')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/2d3e33c6-d8e6-4b51-92d6-dbe8bd9efb05')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "2d3e33c6-d8e6-4b51-92d6-dbe8bd9efb05",
                "displayName": "(Preview) Anomalous Azure AD sign-in sessions",
                "enabled": true,
                "tactics": [
                    "InitialAccess"
                ],
                "anomalyVersion": "1.0.4",
                "techniques": [
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": [
                        {
                            "supportedValues": [
                                "Fraction of failed signins",
                                "Number of failed signins",
                                "Failed signins to successful signins ratio",
                                "Number of signins with incorrect passwords",
                                "Incorrect passwords to correct passwords ratio",
                                "Fraction of incorrect password signins",
                                "Distinct number of app ids",
                                "Distinct number of client apps",
                                "Distinct number of ip addresses",
                                "Distinct number of opperating systems",
                                "Distinct number of browsers",
                                "Distinct number of cities",
                                "Distinct number of states",
                                "Distinct number of countries"
                            ],
                            "values": [
                                "Fraction of failed signins",
                                "Number of failed signins",
                                "Failed signins to successful signins ratio",
                                "Number of signins with incorrect passwords",
                                "Incorrect passwords to correct passwords ratio",
                                "Fraction of incorrect password signins",
                                "Distinct number of app ids",
                                "Distinct number of client apps",
                                "Distinct number of ip addresses",
                                "Distinct number of opperating systems",
                                "Distinct number of browsers",
                                "Distinct number of cities",
                                "Distinct number of states",
                                "Distinct number of countries"
                            ],
                            "supportedValuesKql": null,
                            "valuesKql": null,
                            "name": "Top reason for high anomaly score",
                            "description": "Include only anomalies where the top reason is one of these values.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0.0",
                            "maximum": "1.0",
                            "value": "0.5",
                            "name": "Score",
                            "description": "Generate an anomaly when the anomaly score is greater than or equal to the chosen value.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/8595d264-2f64-442d-b293-4e16dffc9882')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/8595d264-2f64-442d-b293-4e16dffc9882')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "8595d264-2f64-442d-b293-4e16dffc9882",
                "displayName": "(Preview) Anomalous Code Execution",
                "enabled": true,
                "tactics": [
                    "Execution"
                ],
                "anomalyVersion": "1.0.0",
                "techniques": [
                    "T1059"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0",
                            "maximum": "1",
                            "value": "0",
                            "name": "Anomaly score threshold",
                            "description": "Generate an anomaly when the anomaly score is greater than the chosen value.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/c5644575-4982-4a07-8884-b11ec2866dc3')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/c5644575-4982-4a07-8884-b11ec2866dc3')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "c5644575-4982-4a07-8884-b11ec2866dc3",
                "displayName": "(Preview) Anomalous local account creation",
                "enabled": true,
                "tactics": [
                    "Persistence"
                ],
                "anomalyVersion": "1.0.0",
                "techniques": [
                    "T1136"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": [
                        {
                            "prioritize": null,
                            "exclude": "srcdomain1\\account1, srcdomain1\\account1",
                            "dataType": "string",
                            "name": "Source user allowlist",
                            "description": "Enter comma separated source usernames to be suppressed while triggering anomalies. This should be within double quotes and is case sensitive, example: \"srcdomain1\\\\account1, srcdomain2\\\\account2\"",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        },
                        {
                            "prioritize": null,
                            "exclude": "account1, account2",
                            "dataType": "string",
                            "name": "Destination user allowlist",
                            "description": "Enter comma separated destination usernames to be suppressed while triggering anomalies. This should be within double quotes and is case sensitive, example: \"account1, account2\"",
                            "sequenceNumber": 1,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "thresholdObservations": null,
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/2bb167bf-3951-435b-a932-8b03bfde0a2b')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/2bb167bf-3951-435b-a932-8b03bfde0a2b')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "2bb167bf-3951-435b-a932-8b03bfde0a2b",
                "displayName": "(Preview) Anomalous scanning activity",
                "enabled": true,
                "tactics": [
                    "Discovery"
                ],
                "anomalyVersion": "1.0.2",
                "techniques": [
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": [
                        {
                            "supportedValues": [
                                "accept",
                                "allow",
                                "start"
                            ],
                            "values": [
                                "accept",
                                "allow",
                                "start"
                            ],
                            "supportedValuesKql": null,
                            "valuesKql": null,
                            "name": "Device action",
                            "description": "Include only these specific device actions",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": [
                        {
                            "prioritize": null,
                            "exclude": "53,67,80,8080,123,137,138,443,445,3389",
                            "dataType": "string",
                            "name": "Exclude ports",
                            "description": "Provide a comma separated list to exclude specific ports from source data. This should be within double quotes, example: \"53, 67, 80, 8080, 123, 137, 138, 443, 445, 3389\"",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "thresholdObservations": [
                        {
                            "minimum": "1",
                            "maximum": "60000000",
                            "value": "600",
                            "name": "Destination IP count",
                            "description": "The minimum distinct destination IP count per hour required for inclusion. Default is 600. This is an OR condition with destination port count.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        },
                        {
                            "minimum": "1",
                            "maximum": "60000000",
                            "value": "600",
                            "name": "Destination port count",
                            "description": "The minimum distinct destination port count per hour required for inclusion. Default is 600. This is an OR condition with destination IP count.",
                            "sequenceNumber": 1,
                            "rerun": "RerunAlways"
                        },
                        {
                            "minimum": "0.00",
                            "maximum": "1.00",
                            "value": "1.00",
                            "name": "IP ratio",
                            "description": "The distinct source IP (always 1) to distinct destination IP count with a default minimum ratio of 1.00 or lower (converted to Base 10 to the -4 power of original value). This is an OR condition with port ratio.",
                            "sequenceNumber": 2,
                            "rerun": "RerunAlways"
                        },
                        {
                            "minimum": "0.00",
                            "maximum": "1.00",
                            "value": "1.00",
                            "name": "Port ratio",
                            "description": "The distinct source port to distinct destination port count with a default minimum ratio of 1.00 or lower (converted to Base 10 to the -4 power of original value). This is an OR condition with IP Ratio.",
                            "sequenceNumber": 3,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/bb32dc8a-4f6b-4274-a28f-50f3400070b4')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/bb32dc8a-4f6b-4274-a28f-50f3400070b4')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "bb32dc8a-4f6b-4274-a28f-50f3400070b4",
                "displayName": "(Preview) Anomalous Sign In",
                "enabled": true,
                "tactics": [
                    "InitialAccess"
                ],
                "anomalyVersion": "1.0.1",
                "techniques": [
                    "T1078"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0",
                            "maximum": "1",
                            "value": "0.2",
                            "name": "Anomaly score threshold",
                            "description": "Generate an anomaly when the anomaly score is greater than the chosen value.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/16d55bbb-8c54-4c1d-8537-521824e76bb6')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/16d55bbb-8c54-4c1d-8537-521824e76bb6')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "16d55bbb-8c54-4c1d-8537-521824e76bb6",
                "displayName": "(Preview) Anomalous user activities in Office Exchange",
                "enabled": true,
                "tactics": [
                    "Collection",
                    "Persistence"
                ],
                "anomalyVersion": "1.0.2",
                "techniques": [
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": [
                        {
                            "supportedValues": [
                                "Distinct number of operations",
                                "Distinct number of ClientInfoString",
                                "Distinct number of mailboxes",
                                "Number of operations",
                                "Distinct number of IP addresses",
                                "Distinct number of /24 subnets",
                                "Distinct number of /16 subnets",
                                "Number of MessageBind operations",
                                "Number of FolderBind operations",
                                "Number of UpdateInboxRules operations",
                                "Number of MailItemsAccessed operations"
                            ],
                            "values": [
                                "Distinct number of operations",
                                "Distinct number of ClientInfoString",
                                "Distinct number of mailboxes",
                                "Number of operations",
                                "Distinct number of IP addresses",
                                "Distinct number of /24 subnets",
                                "Distinct number of /16 subnets",
                                "Number of MessageBind operations",
                                "Number of FolderBind operations",
                                "Number of UpdateInboxRules operations",
                                "Number of MailItemsAccessed operations"
                            ],
                            "supportedValuesKql": null,
                            "valuesKql": null,
                            "name": "Top reason for high anomaly score",
                            "description": "Include only anomalies where the top reason is one of these values.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0.0",
                            "maximum": "1.0",
                            "value": "0.6",
                            "name": "Score",
                            "description": "Generate an anomaly when the anomaly score is greater than or equal to the chosen value.",
                            "sequenceNumber": 0,
                            "rerun": "NotRequired"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/8a12afde-ed27-46ac-a5ef-392e3d4f071f')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/8a12afde-ed27-46ac-a5ef-392e3d4f071f')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "8a12afde-ed27-46ac-a5ef-392e3d4f071f",
                "displayName": "(Preview) Anomalous W3CIIS logs activity",
                "enabled": true,
                "tactics": [
                    "InitialAccess",
                    "Persistence"
                ],
                "anomalyVersion": "1.0.0",
                "techniques": [
                    "T1190",
                    "T1505"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": [
                        {
                            "supportedValues": [
                                "1",
                                "2",
                                "3"
                            ],
                            "supportedValuesKql": null,
                            "value": "3",
                            "name": "Number of reasons for anomalous activity",
                            "description": "Provide explanations for the specified number of reasons why a W3CIIS session is anomalous.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        },
                        {
                            "supportedValues": [
                                "Distinct number of methods",
                                "Distinct number of uri queries",
                                "Distinct number of uri stems",
                                "Distinct number of statuses",
                                "Distinct number of user agents",
                                "Total number of operations",
                                "Total number of http verbs",
                                "Total number of http statuses",
                                "None"
                            ],
                            "supportedValuesKql": null,
                            "value": "None",
                            "name": "Display anomalies for a specific top reason",
                            "description": "Display anomalies only where the top reason is specified in the checklist.",
                            "sequenceNumber": 1,
                            "rerun": "RerunAlways"
                        },
                        {
                            "supportedValues": [
                                "Public IPs",
                                "Private IPs",
                                "All IPs"
                            ],
                            "supportedValuesKql": null,
                            "value": "All IPs",
                            "name": "Display anomalies for public, private, or all IPs",
                            "description": "Choose to display anomalies for public, private, or all IPs.",
                            "sequenceNumber": 2,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "prioritizeExcludeObservations": [
                        {
                            "prioritize": null,
                            "exclude": null,
                            "dataType": "string",
                            "name": "Exclude client IPs from the anomalies generated",
                            "description": "Enter comma separated client IPs (prefixed client IP entities supported) that the anomalies should not display results for, in the exclude field.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "thresholdObservations": [
                        {
                            "minimum": "0.0",
                            "maximum": "1.0",
                            "value": "0.7",
                            "name": "Score",
                            "description": "Generate an anomaly when the anomaly score is greater than or equal to the chosen value.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/edc946ae-cba8-419f-8e90-309966895956')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/edc946ae-cba8-419f-8e90-309966895956')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "edc946ae-cba8-419f-8e90-309966895956",
                "displayName": "(Preview) Anomalous web request activity",
                "enabled": true,
                "tactics": [
                    "InitialAccess",
                    "Persistence"
                ],
                "anomalyVersion": "1.0.2",
                "techniques": [
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": [
                        {
                            "supportedValues": [
                                "Include regularly repeating anomalies for URI stems",
                                "Exclude regularly repeating anomalies for URI stems"
                            ],
                            "supportedValuesKql": null,
                            "value": "Exclude regularly repeating anomalies for URI stems",
                            "name": "Handle regularly repeating anomalies for URI stems",
                            "description": "Choose to exclude URI stems that have been regularly occuring in the Anomalies table in Log Analytics.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "prioritizeExcludeObservations": [
                        {
                            "prioritize": ".asp, .aspx, .armx, .asax, .ashz, .asmx, .axd, .cshtml, .php, .phps, .php3, .php4, .php5, .php7, .jsp, .jspx, .cfm, .cfml, .phtml",
                            "exclude": null,
                            "dataType": "string",
                            "name": "Prioritize script suffixes of the URI stems",
                            "description": "Give comma separated script suffixes of the URI stems that should be included in the prioritize field.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        },
                        {
                            "prioritize": null,
                            "exclude": "",
                            "dataType": "string",
                            "name": "Exclude noisy URI stems",
                            "description": "Give comma separated URI stems that are frequently observing noisy sessions, and should be excluded from the Anomalies table in Log Analytics.",
                            "sequenceNumber": 1,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "thresholdObservations": [
                        {
                            "minimum": "0.0",
                            "maximum": "1.0",
                            "value": "0.2",
                            "name": "Score",
                            "description": "Generate an anomaly when the anomaly score is greater than or equal to the chosen value.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/8a602940-4153-4045-a741-3bf15591ae29')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/8a602940-4153-4045-a741-3bf15591ae29')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "8a602940-4153-4045-a741-3bf15591ae29",
                "displayName": "(Preview) Attempted computer bruteforce",
                "enabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "anomalyVersion": "1.2.8",
                "techniques": [
                    "T1110"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0",
                            "maximum": "1",
                            "value": "0.4",
                            "name": "Score",
                            "description": "Generate an anomaly when score is greater than the chosen value",
                            "sequenceNumber": 1,
                            "rerun": "NotRequired"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/ffe3625d-a933-4f63-b192-7e6ebf3be5fb')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/ffe3625d-a933-4f63-b192-7e6ebf3be5fb')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "ffe3625d-a933-4f63-b192-7e6ebf3be5fb",
                "displayName": "(Preview) Attempted user account bruteforce",
                "enabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "anomalyVersion": "1.2.8",
                "techniques": [
                    "T1110"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0",
                            "maximum": "1",
                            "value": "0.1",
                            "name": "Score",
                            "description": "Generate an anomaly when score is greater than the chosen value",
                            "sequenceNumber": 1,
                            "rerun": "NotRequired"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/93c4b361-ea7d-40f4-9ca6-e501cdef9c53')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/93c4b361-ea7d-40f4-9ca6-e501cdef9c53')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "93c4b361-ea7d-40f4-9ca6-e501cdef9c53",
                "displayName": "(Preview) Attempted user account bruteforce per failure reason",
                "enabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "anomalyVersion": "1.1.6",
                "techniques": [
                    "T1110"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": [
                        {
                            "supportedValues": [
                                "\\%%2305-The specified user account has expired",
                                "\\%%2309-The specified account's password has expired",
                                "\\%%2310-Account currently disabled",
                                "\\%%2311-Account logon time restriction violation",
                                "\\%%2312-User not allowed to logon at this computer",
                                "\\%%2313-Unknown user name or bad password",
                                "\\%%2307-Account locked out",
                                "\\%%2304-An Error occurred during Logon"
                            ],
                            "values": [
                                "\\%%2305-The specified user account has expired",
                                "\\%%2309-The specified account's password has expired",
                                "\\%%2310-Account currently disabled",
                                "\\%%2311-Account logon time restriction violation",
                                "\\%%2312-User not allowed to logon at this computer",
                                "\\%%2313-Unknown user name or bad password",
                                "\\%%2307-Account locked out",
                                "\\%%2304-An Error occurred during Logon"
                            ],
                            "supportedValuesKql": null,
                            "valuesKql": null,
                            "name": "Failure Reasons",
                            "description": "Include only selected failure reasons in anomaly results.",
                            "sequenceNumber": 0,
                            "rerun": "NotRequired"
                        }
                    ],
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0",
                            "maximum": "1",
                            "value": "0.3",
                            "name": "Score",
                            "description": "Generate an anomaly when score is greater than the chosen value",
                            "sequenceNumber": 1,
                            "rerun": "NotRequired"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/c097bfdb-8b4b-4a98-b74d-1871ffd50a03')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/c097bfdb-8b4b-4a98-b74d-1871ffd50a03')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "c097bfdb-8b4b-4a98-b74d-1871ffd50a03",
                "displayName": "(Preview) Attempted user account bruteforce per logon type",
                "enabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "anomalyVersion": "1.0.6",
                "techniques": [
                    "T1110"
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": [
                        {
                            "supportedValues": [
                                "2-Interactive",
                                "3-Network",
                                "4-Batch",
                                "5-Service",
                                "7-Unlock",
                                "8-NetworkCleartext",
                                "9-NewCredentials",
                                "10-RemoteInteractive",
                                "11-CachedInteractive"
                            ],
                            "values": [
                                "2-Interactive",
                                "3-Network",
                                "4-Batch",
                                "5-Service",
                                "7-Unlock",
                                "8-NetworkCleartext",
                                "9-NewCredentials",
                                "10-RemoteInteractive",
                                "11-CachedInteractive"
                            ],
                            "supportedValuesKql": null,
                            "valuesKql": null,
                            "name": "Logon Types",
                            "description": "Include only selected logon types in anomaly results.",
                            "sequenceNumber": 0,
                            "rerun": "NotRequired"
                        }
                    ],
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "0",
                            "maximum": "1",
                            "value": "0.03",
                            "name": "Score",
                            "description": "Generate an anomaly when score is greater than the chosen value",
                            "sequenceNumber": 1,
                            "rerun": "NotRequired"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/622844c2-fc11-4efc-91e6-c05b06ab3008')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/622844c2-fc11-4efc-91e6-c05b06ab3008')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "622844c2-fc11-4efc-91e6-c05b06ab3008",
                "displayName": "(Preview) Detect machine generated network beaconing behavior",
                "enabled": true,
                "tactics": [
                    "CommandAndControl"
                ],
                "anomalyVersion": "1.0.4",
                "techniques": [
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": null,
                    "thresholdObservations": [
                        {
                            "minimum": "10",
                            "maximum": "1000",
                            "value": "25",
                            "name": "Degree of source IPs",
                            "description": "Suppress anomalies when degree of source IPs is greater than the chosen value",
                            "sequenceNumber": 1,
                            "rerun": "RerunAlways"
                        },
                        {
                            "minimum": "10",
                            "maximum": "1000",
                            "value": "30",
                            "name": "Daily event count threshold",
                            "description": "Suppress anomalies when daily event count is less than the chosen value",
                            "sequenceNumber": 2,
                            "rerun": "RerunAlways"
                        },
                        {
                            "minimum": "10",
                            "maximum": "1000",
                            "value": "60",
                            "name": "Time delta threshold in seconds",
                            "description": "Suppress anomalies when time delta in seconds between network connections is less than the chosen value",
                            "sequenceNumber": 3,
                            "rerun": "RerunAlways"
                        },
                        {
                            "minimum": "50",
                            "maximum": "100",
                            "value": "75",
                            "name": "Percent beaconing threshold",
                            "description": "Generate an anomaly when percent beaconing is greater than the chosen value",
                            "sequenceNumber": 4,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/b783df9c-4088-452e-a791-0c4fca47a109')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/b783df9c-4088-452e-a791-0c4fca47a109')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Anomaly",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "alertRuleTemplateName": "b783df9c-4088-452e-a791-0c4fca47a109",
                "displayName": "(Preview) Domain generation algorithm (DGA) on DNS domains",
                "enabled": true,
                "tactics": [
                    "CommandAndControl"
                ],
                "anomalyVersion": "1.0.4",
                "techniques": [
                ],
                "frequency": "P1D",
                "ruleStatus": "Production",
                "isDefaultRule": true,
                "anomalyRuleVersion": 0,
                "customizableObservations": {
                    "multiSelectObservations": null,
                    "singleSelectObservations": null,
                    "prioritizeExcludeObservations": [
                        {
                            "prioritize": null,
                            "exclude": ".lan, .home",
                            "dataType": "string",
                            "name": "Top level domain",
                            "description": "Give comma separated TLDs to exclude from source data within double quotes, example: \".lan, .home\"",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "thresholdObservations": [
                        {
                            "minimum": "0.0",
                            "maximum": "1.0",
                            "value": "0.9",
                            "name": "Score",
                            "description": "Generate an anomaly when the anomaly score is greater than or equal to the chosen value.",
                            "sequenceNumber": 0,
                            "rerun": "RerunAlways"
                        }
                    ],
                    "singleValueObservations": null
                }
            }
        }
    ]
}