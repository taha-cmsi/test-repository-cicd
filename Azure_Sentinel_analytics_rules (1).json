{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        }
    },
    "resources": [
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/c5930123-5d38-4e11-b0dd-cc2c837479fb')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/c5930123-5d38-4e11-b0dd-cc2c837479fb')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Added a User to an Admin Role in Office 365 (SOC Prime)",
                "description": "This rule triggered when a user is added to an admin role in Office 365. By the help of this rule we can detect the legitimate or illegitimate addition in Admin role.\nTechnique: T1098.",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"Add member to role\") and (ResultStatus == \"Success\") and (ModifiedProperties contains \"admin\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Persistence"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "AadUserId",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/BuiltInFusion')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/BuiltInFusion')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Fusion",
            "apiVersion": "2021-10-01-preview",
            "properties": {
                "enabled": true,
                "alertRuleTemplateName": "f71aba3d-28fb-450b-b192-4e76a83015c8",
                "sourceSettings": [
                    {
                        "enabled": true,
                        "sourceName": "Anomalies",
                        "sourceSubTypes": null
                    },
                    {
                        "enabled": true,
                        "sourceName": "Alert providers",
                        "sourceSubTypes": [
                            {
                                "sourceSubTypeName": "Azure Active Directory Identity Protection",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            },
                            {
                                "sourceSubTypeName": "Azure Defender",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            },
                            {
                                "sourceSubTypeName": "Azure Defender for IoT",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            },
                            {
                                "sourceSubTypeName": "Microsoft 365 Defender",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            },
                            {
                                "sourceSubTypeName": "Microsoft Cloud App Security",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            },
                            {
                                "sourceSubTypeName": "Microsoft Defender for Endpoint",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            },
                            {
                                "sourceSubTypeName": "Microsoft Defender for Identity",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            },
                            {
                                "sourceSubTypeName": "Microsoft Defender for Office 365",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            },
                            {
                                "sourceSubTypeName": "Azure Sentinel scheduled analytics rules",
                                "enabled": true,
                                "severityFilter": [
                                    "High",
                                    "Medium",
                                    "Low",
                                    "Informational"
                                ],
                                "severityFilters": {
                                    "isSupported": true,
                                    "filters": [
                                        {
                                            "severity": "High",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Medium",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Low",
                                            "enabled": true
                                        },
                                        {
                                            "severity": "Informational",
                                            "enabled": true
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        "enabled": true,
                        "sourceName": "Raw logs from other sources",
                        "sourceSubTypes": [
                            {
                                "sourceSubTypeName": "Palo Alto Networks",
                                "enabled": true,
                                "severityFilter": null,
                                "severityFilters": {
                                    "isSupported": false,
                                    "filters": null
                                }
                            }
                        ]
                    }
                ],
                "scenarioExclusionPatterns": []
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/24d952da-8bb9-4c4e-bb0b-61679329935e')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/24d952da-8bb9-4c4e-bb0b-61679329935e')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Bulk O365 Membership List Manipulation (SOC Prime)",
                "description": "This rule will trigger when the adversary tries to manipulate the role group members in the exchange admin center. This rule detects the updating of the members of the role groups like adds multiple members to, and removes multiple members from, a role group without replacing all the existing members on the role group.\nThis rule detects the updation of members by UI and also if this is done with the help of some programmatic source.\nTechnique: T1098.",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity | where (Operation == \"Update-RoleGroupMember\") | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Persistence"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "NTDomain",
                                "columnName": "RecordType"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP_"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/92346830-7225-42a6-aceb-a880a2dc1258')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/92346830-7225-42a6-aceb-a880a2dc1258')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Correlate Unfamiliar sign-in properties and atypical travel alerts",
                "description": "The combination of an Unfamiliar sign-in properties alert and an Atypical travel alert about the same user within a +10m or -10m window is considered a high severity incident.",
                "severity": "High",
                "enabled": true,
                "query": "let Alert1 = \nSecurityAlert\n| where AlertName == \"Unfamiliar sign-in properties\"\n| extend UserPrincipalName = tostring(parse_json(ExtendedProperties).[\"User Account\"])\n| extend Alert1Time = TimeGenerated\n| extend Alert1 = AlertName\n| extend Alert1Severity = AlertSeverity\n;\nlet Alert2 = \nSecurityAlert\n| where AlertName == \"Atypical travel\"\n| extend UserPrincipalName = tostring(parse_json(ExtendedProperties).[\"User Account\"])\n| extend Alert2Time = TimeGenerated\n| extend Alert2 = AlertName\n| extend Alert2Severity = AlertSeverity\n| extend CurrentLocation = strcat(tostring(parse_json(tostring(parse_json(Entities)[1].Location)).CountryCode), \"|\", tostring(parse_json(tostring(parse_json(Entities)[1].Location)).State), \"|\", tostring(parse_json(tostring(parse_json(Entities)[1].Location)).City))\n| extend PreviousLocation = strcat(tostring(parse_json(tostring(parse_json(Entities)[2].Location)).CountryCode), \"|\", tostring(parse_json(tostring(parse_json(Entities)[2].Location)).State), \"|\", tostring(parse_json(tostring(parse_json(Entities)[2].Location)).City))\n| extend CurrentIPAddress = tostring(parse_json(Entities)[1].Address)\n| extend PreviousIPAddress = tostring(parse_json(Entities)[2].Address)\n;\nAlert1\n| join kind=inner Alert2 on UserPrincipalName\n| where abs(datetime_diff('minute', Alert1Time, Alert2Time)) <=10\n| extend TimeDelta = Alert1Time - Alert2Time\n| project UserPrincipalName, Alert1, Alert1Time, Alert1Severity, Alert2, Alert2Time, Alert2Severity, TimeDelta, CurrentLocation, PreviousLocation, CurrentIPAddress, PreviousIPAddress\n| extend AccountCustomEntity = UserPrincipalName\n| extend IPCustomEntity = CurrentIPAddress",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "InitialAccess"
                ],
                "alertRuleTemplateName": "a3df4a32-4805-4c6d-8699-f3c888af2f67",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": true,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "AccountCustomEntity"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "IPCustomEntity"
                            }
                        ]
                    }
                ],
                "templateVersion": "1.0.0"
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f9bbb886-765b-4a8a-9ca0-aed89d80afc8')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f9bbb886-765b-4a8a-9ca0-aed89d80afc8')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "MicrosoftSecurityIncidentCreation",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Create incidents based on Azure Active Directory Identity Protection alerts",
                "description": "Create incidents based on all alerts generated in Azure Active Directory Identity Protection",
                "enabled": true,
                "productFilter": "Azure Active Directory Identity Protection",
                "severitiesFilter": null,
                "displayNamesFilter": null,
                "displayNamesExcludeFilter": null,
                "alertRuleTemplateName": null
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/da2b1189-604e-4fda-b172-d8ee5ae7fe51')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/da2b1189-604e-4fda-b172-d8ee5ae7fe51')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "MicrosoftSecurityIncidentCreation",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Create incidents based on Azure Active Directory Identity Protection alerts",
                "description": "Create incidents based on all alerts generated in Azure Active Directory Identity Protection",
                "enabled": true,
                "productFilter": "Azure Active Directory Identity Protection",
                "severitiesFilter": null,
                "displayNamesFilter": null,
                "displayNamesExcludeFilter": null,
                "alertRuleTemplateName": "532c1811-79ee-4d9f-8d4d-6304c840daa1"
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/1f73d941-fc6c-4944-a6b6-e4100d9a84c6')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/1f73d941-fc6c-4944-a6b6-e4100d9a84c6')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "MicrosoftSecurityIncidentCreation",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Create incidents based on Azure Advanced Threat Protection alerts",
                "description": "Create incidents based on all alerts generated in Azure Advanced Threat Protection",
                "enabled": false,
                "productFilter": "Azure Advanced Threat Protection",
                "severitiesFilter": null,
                "displayNamesFilter": null,
                "displayNamesExcludeFilter": null,
                "alertRuleTemplateName": "40ba9493-4183-4eee-974f-87fe39c8f267"
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/2c9aa24a-49f5-4eea-89b8-228c8b472ede')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/2c9aa24a-49f5-4eea-89b8-228c8b472ede')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "MicrosoftSecurityIncidentCreation",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Create incidents based on Azure Security Center alerts",
                "description": "Create incidents based on all alerts generated in Azure Security Center",
                "enabled": true,
                "productFilter": "Azure Security Center",
                "severitiesFilter": null,
                "displayNamesFilter": null,
                "displayNamesExcludeFilter": null,
                "alertRuleTemplateName": "90586451-7ba8-4c1e-9904-7d1b7c3cc4d6"
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/e88d280b-329e-4ad9-9652-1367ddf5664d')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/e88d280b-329e-4ad9-9652-1367ddf5664d')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "MicrosoftSecurityIncidentCreation",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Create incidents based on Microsoft Cloud App Security alerts",
                "description": "Create incidents based on all alerts generated in Microsoft Cloud App Security",
                "enabled": false,
                "productFilter": "Microsoft Cloud App Security",
                "severitiesFilter": null,
                "displayNamesFilter": null,
                "displayNamesExcludeFilter": null,
                "alertRuleTemplateName": "b3cfc7c0-092c-481c-a55b-34a3979758cb"
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/1a6d8d1f-77df-41e4-82f1-3abd98c483bc')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/1a6d8d1f-77df-41e4-82f1-3abd98c483bc')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "MicrosoftSecurityIncidentCreation",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Create incidents based on Microsoft Defender Advanced Threat Protection alerts",
                "description": "Create incidents based on all alerts generated in Microsoft Defender Advanced Threat Protection",
                "enabled": false,
                "productFilter": "Microsoft Defender Advanced Threat Protection",
                "severitiesFilter": null,
                "displayNamesFilter": null,
                "displayNamesExcludeFilter": null,
                "alertRuleTemplateName": "327cd4ed-ca42-454b-887c-54e1c91363c6"
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/ceb96e25-2077-4319-b7ae-2cc72cf34e0e')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/ceb96e25-2077-4319-b7ae-2cc72cf34e0e')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "MicrosoftSecurityIncidentCreation",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Create incidents based on Office 365 Advanced Threat Protection alerts",
                "description": "Create incidents based on all alerts generated in Office 365 Advanced Threat Protection",
                "enabled": false,
                "productFilter": "Office 365 Advanced Threat Protection",
                "severitiesFilter": null,
                "displayNamesFilter": null,
                "displayNamesExcludeFilter": null,
                "alertRuleTemplateName": "ee1d718b-9ed9-4a71-90cd-a483a4f008df"
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/152fb1ec-fc8f-4d09-840e-1ad0caa21ba9')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/152fb1ec-fc8f-4d09-840e-1ad0caa21ba9')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "HackTools Detected in an O365 App (SOC Prime)",
                "description": "Hacktools can be used to patch or \"crack\" some software so it will run without a valid license or genuine product key.\nThis rule will trigger when the adversary tries to upload, download or access the suspicious file from the Microsoft cloud applications. These suspicious files can be any type of HackTools that can harm the infrastructure by their malicious intends.\nBeware of running hacktools because they can be associated with malware or unwanted software and names, like empire scripts, etc. Technique: T1204.",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"FileUploaded\" or Operation == \"FileAccessed\" or Operation == \"FileDownloaded\") and (SourceFileName contains \"Obfuscation\" or SourceFileName contains \"PowerShellLauncher\" or SourceFileName contains \"EncodedAsciiCommand\" or SourceFileName contains \"EncodedHexCommand\" or SourceFileName contains \"EncodedBXORCommand\" or SourceFileName contains \"EncodedWhitespaceCommand\" or SourceFileName contains \"EncodedBinaryCommand\" or SourceFileName contains \"EncodedOctalCommand\" or SourceFileName contains \"EncodedSpecialCharOnlyCommand\" or SourceFileName contains \"SecureStringCommand\" or SourceFileName contains \"ObfuscatedStringCommand\" or SourceFileName contains \"ObfuscatedTokenCommand\" or SourceFileName contains \"Obfuscated\" or SourceFileName contains \"ToObfuscate\" or SourceFileName contains \"EternalBlue\" or SourceFileName contains \"PostExfil\" or SourceFileName contains \"ExfilDataToGitHub\" or SourceFileName contains \"EgressCheck\" or SourceFileName contains \"NetRipper\" or SourceFileName contains \"Minidump\" or SourceFileName contains \"SQLColumnSampleData\" or SourceFileName contains \"Inveigh\" or SourceFileName contains \"FoxDump\" or SourceFileName contains \"USBKeystrokes\" or SourceFileName contains \"NinjaCopy\" or SourceFileName contains \"SQLQuery\" or SourceFileName contains \"Keystrokes\" or SourceFileName contains \"KeePassConfig\" or SourceFileName contains \"KeeThief\" or SourceFileName contains \"BrowserData\" or SourceFileName contains \"ClipboardContents\" or SourceFileName contains \"IndexedItem\" or SourceFileName contains \"ChromeDump\" or SourceFileName contains \"TrustedDocuments\" or SourceFileName contains \"Paranoia\" or SourceFileName contains \"MonitorTCPConnections\" or SourceFileName contains \"WinEnum\" or SourceFileName contains \"ComputerDetails\" or SourceFileName contains \"SystemDNSServer\" or SourceFileName contains \"powerview\" or SourceFileName contains \"BloodHound\" or SourceFileName contains \"ARPScan\" or SourceFileName contains \"SQLServerInfo\" or SourceFileName contains \"SMBAutoBrute\" or SourceFileName contains \"SQLInstanceDomain\" or SourceFileName contains \"ReverseDNSLookup\" or SourceFileName contains \"SmbScanner\" or SourceFileName contains \"Portscan\" or SourceFileName contains \"MacAttribute\" or SourceFileName contains \"MailRaider\" or SourceFileName contains \"HoneyHash\" or SourceFileName contains \"PSInject\" or SourceFileName contains \"ReflectivePEInjection\" or SourceFileName contains \"Thunderstruck\" or SourceFileName contains \"VoiceTroll\" or SourceFileName contains \"InveighRelay\" or SourceFileName contains \"SSHCommand\" or SourceFileName contains \"SQLOSCmd\" or SourceFileName contains \"PsExec\" or SourceFileName contains \"ExecuteMSBuild\" or SourceFileName contains \"SMBExec\" or SourceFileName contains \"PowerBreach\" or SourceFileName contains \"BackdoorLNK\" or SourceFileName contains \"SecurityPackages\" or SourceFileName contains \"RickAstley\" or SourceFileName contains \"MetasploitPayload\" or SourceFileName contains \"ShellcodeMSIL\" or SourceFileName contains \"Shellcode\" or SourceFileName contains \"ReflectivePEInjection\" or SourceFileName contains \"DllInjection\" or SourceFileName contains \"SQLServerLoginDefaultPw\" or SourceFileName contains \"SiteListPassword\" or SourceFileName contains \"BypassUAC\" or SourceFileName contains \"GPPPassword\" or SourceFileName contains \"BypassUACTokenManipulation\" or SourceFileName contains \"EventVwrBypass\" or SourceFileName contains \"SDCLTBypass\" or SourceFileName contains \"MS16135\" or SourceFileName contains \"EnvBypass\" or SourceFileName contains \"FodHelperBypass\" or SourceFileName contains \"WScriptBypassUAC\" or SourceFileName contains \"MS16032\" or SourceFileName contains \"PowerUp\" or SourceFileName contains \"Mimikatz\" or SourceFileName contains \"Kerberoast\" or SourceFileName contains \"SessionGopher\" or SourceFileName contains \"CredentialInjection\" or SourceFileName contains \"dumpCredStore\" or SourceFileName contains \"TokenManipulation\" or SourceFileName contains \"DCSync\" or SourceFileName contains \"VaultCredential\" or SourceFileName contains \"PowerDump\" or SourceFileName contains \"http_com\" or SourceFileName contains \"http_mapi\" or SourceFileName contains \"DomainSPNTicket\" or SourceFileName contains \"SPNTicket\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "InstanceName",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeObjectId"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName_"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl_"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "OfficeId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/0c914264-3f01-4541-b6ec-6afbee85f7b2')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/0c914264-3f01-4541-b6ec-6afbee85f7b2')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Modify Authentication Process - Pluggable Authentication Modules(PAM) in Linux",
                "description": "The rule will trigger when adversary tries to modify or make changes to the PAM directory. Pluggable Authentication Modules (PAM) is a suite of libraries that allows a Linux system administrator to configure methods to authenticate users.\nAdversaries may modify pluggable authentication modules (PAM) to access user credentials or enable otherwise unwarranted access to accounts. PAM is a modular system of configuration files, libraries, and executable files which guide authentication for many services. \nhttps://attack.mitre.org/techniques/T1556/003/",
                "severity": "High",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"/etc/pam.d/\" or SyslogMessage contains \"pam_succeed_if\"\r\n| where Facility contains \"authpriv\"\r\n| where Type contains \"Syslog\"\r\n| where SourceSystem contains \"Linux\"\r\n| project SourceSystem, HostIP, HostName, Facility, SyslogMessage, Type, EventTime\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Persistence",
                    "CredentialAccess",
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/b21d2324-1557-423c-b44c-cbddd0600848')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/b21d2324-1557-423c-b44c-cbddd0600848')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Network Scan Tools Detected in an O365 App (SOC Prime)",
                "description": "The Network scanning tools are used for network discovery. It can scan ports and vulnerabilities to obtain information on hosts available on the network and services running on them.   \nAdversaries may attempt to get the list of services running on the hosts that may have remote software exploitation vulnerability. The method to acquire the information include port scanning and vulnerability scanning. The rule will trigger when the tool is uploaded, downloaded or accessed in the O365 app. \nFor more information, please visit this link: https://attack.mitre.org/techniques/T1046/\n\n",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity \r\n| where ((Operation == \"FileUploaded\" or Operation == \"FileAccessed\" or Operation == \"FileDownloaded\") and (SourceFileName contains \"ipscan\" or SourceFileName contains \"ip_scan\" or SourceFileName contains \"ip-scan\" or SourceFileName contains \"netscan\" or SourceFileName contains \"nmap\" or SourceFileName contains \"scanner.exe\" or SourceFileName contains \"superscan\" or SourceFileName contains \"zenmap\" or SourceFileName contains \"nbtscan\" or SourceFileName contains \"enumera\" or SourceFileName contains \"enumera\")) \r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl_"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "OfficeId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/00ef1c14-a77d-48f1-bf2c-c6f45f37fa3f')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/00ef1c14-a77d-48f1-bf2c-c6f45f37fa3f')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Possible Remote Administration Tools Detected in an O365 App (SOC Prime)",
                "description": "The remote administration tool is used to access the application/system remotely. The adversary installed the tool and then accessed the system/applications for malicious purposes.  This rule will trigger when the adversary installed any of the remote tools on the O365 app.\n\nA remote administration tool is software that helps an administrator or malicious actor receive full control of a targeted device. Technique: T1204.",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"FileUploaded\" or Operation == \"FileAccessed\" or Operation == \"FileDownloaded\") and (SourceFileName contains \"famitrfc\" or SourceFileName contains \"g2fileh\" or SourceFileName contains \"g2host\" or SourceFileName contains \"g2mainh\" or SourceFileName contains \"g2printh\" or SourceFileName contains \"g2svc\" or SourceFileName contains \"g2tray\" or SourceFileName contains \"gopcsrv\" or SourceFileName contains \"lmiguardiansvc\" or SourceFileName contains \"logmein\" or SourceFileName contains \"showmypc\" or SourceFileName contains \"vncviewer\" or SourceFileName contains \"winvncsc\" or SourceFileName contains \"aa_v\" or SourceFileName contains \"awhost32\" or SourceFileName contains \"awrem32\" or SourceFileName contains \"dwrcs\" or SourceFileName contains \"g2comm\" or SourceFileName contains \"lmiignition\" or SourceFileName contains \"mstsc\" or SourceFileName contains \"radmin\" or SourceFileName contains \"smpcsetup\" or SourceFileName contains \"teamviewer\" or SourceFileName contains \"termsrv\" or SourceFileName contains \"winvnc\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "UserId_"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl_"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f0697089-a121-4de6-9146-2cf03eb47a18')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f0697089-a121-4de6-9146-2cf03eb47a18')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Rootkit Tool Detected (Loadable kernel module) in Linux Environment",
                "description": "The rule will trigger when rootkit tool is detected on linux endpoint. A rootkit is a set of tools with the goal to hide its presence and to continue providing system access to an attacker.\nAdversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information.\nReferences https://attack.mitre.org/techniques/T1014/",
                "severity": "High",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"modprobe\" or SyslogMessage contains \"insmod\"\r\n| where Type contains \"Syslog\"\r\n| where Facility contains \"authpriv\"\r\n| where SourceSystem contains \"Linux\"\r\n| project HostName, SyslogMessage, EventTime,HostIP,Type, ProcessName , Facility, SourceSystem\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/35655c62-9604-4f6d-aa0a-1301ff571126')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/35655c62-9604-4f6d-aa0a-1301ff571126')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Solorigate Network Beacon",
                "description": "The rule will triggered when it Identifies a match across various data feeds for domains IOCs related to the Solorigate incident.\n References: https://blogs.microsoft.com/on-the-issues/2020/12/13/customers-protect-nation-state-cyberattacks/, \n https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html?1",
                "severity": "High",
                "enabled": true,
                "query": "let domains = dynamic([\"incomeupdate.com\",\"zupertech.com\",\"databasegalore.com\",\"panhardware.com\",\"avsvmcloud.com\",\"digitalcollege.org\",\"freescanonline.com\",\"deftsecurity.com\",\"thedoccloud.com\",\"virtualdataserver.com\",\"lcomputers.com\",\"webcodez.com\",\"globalnetworkissues.com\",\"kubecloud.com\",\"seobundlekit.com\",\"solartrackingsystem.net\",\"virtualwebdata.com\"]);\n(union isfuzzy=true\n(CommonSecurityLog \n  | parse Message with * '(' DNSName ')' * \n  | where DNSName in~ (domains) or DestinationHostName has_any (domains) or RequestURL has_any(domains)\n  | extend AccountCustomEntity = SourceUserID, HostCustomEntity = DeviceName, IPCustomEntity = SourceIP\n  ),\n(DnsEvents \n  | extend DNSName = Name\n  | where isnotempty(DNSName)\n  | where DNSName has_any (domains)\n  | extend IPCustomEntity = ClientIP\n  ),\n(imDns \n  | where isnotempty(DnsQuery)\n  | where DnsQuery has_any (domains)\n  | extend DNSName = DnsQuery\n  | extend IPCustomEntity = SrcIpAddr\n  ),\n(VMConnection \n  | parse RemoteDnsCanonicalNames with * '[\"' DNSName '\"]' *\n  | where isnotempty(DNSName)\n  | where DNSName in~ (domains)\n  | extend IPCustomEntity = RemoteIp\n  ),\n(DeviceNetworkEvents \n  | where isnotempty(RemoteUrl) \n  | where RemoteUrl  has_any (domains)  \n  | extend DNSName = RemoteUrl\n  | extend IPCustomEntity = RemoteIP \n  | extend HostCustomEntity = DeviceName \n  ),\n(AzureDiagnostics\n  | where ResourceType == \"AZUREFIREWALLS\"\n  | where Category == \"AzureFirewallDnsProxy\"\n  | parse msg_s with \"DNS Request: \" ClientIP \":\" ClientPort \" - \" QueryID \" \" Request_Type \" \" Request_Class \" \" Request_Name \". \" Request_Protocol \" \" Request_Size \" \" EDNSO_DO \" \" EDNS0_Buffersize \" \" Responce_Code \" \" Responce_Flags \" \" Responce_Size \" \" Response_Duration\n  | where Request_Name has_any (domains)  \n  | extend DNSName = Request_Name\n  | extend IPCustomEntity = ClientIP \n  ),\n(AzureDiagnostics \n  | where ResourceType == \"AZUREFIREWALLS\"\n  | where Category == \"AzureFirewallApplicationRule\"\n  | parse msg_s with Protocol 'request from ' SourceHost ':' SourcePort 'to ' DestinationHost ':' DestinationPort '. Action:' Action\n  | where isnotempty(DestinationHost)\n  | where DestinationHost has_any (domains)  \n  | extend DNSName = DestinationHost \n  | extend IPCustomEntity = SourceHost\n  ) \n  )",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CommandAndControl"
                ],
                "alertRuleTemplateName": "cecdbd4c-4902-403c-8d4b-32eb1efe460b",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "InitiatingProcessAccountUpn"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "InitiatingProcessAccountName"
                            },
                            {
                                "identifier": "AadUserId",
                                "columnName": "InitiatingProcessAccountSid"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostCustomEntity"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "InitiatingProcessFileName"
                            },
                            {
                                "identifier": "NetBiosName",
                                "columnName": "InitiatingProcessFolderPath"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Directory",
                                "columnName": "RemoteUrl"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "IPCustomEntity"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "InitiatingProcessFileName"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "InitiatingProcessCommandLine"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "IPCustomEntity"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/a4d4121a-568f-4c56-9b23-f659071a9e1d')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/a4d4121a-568f-4c56-9b23-f659071a9e1d')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "SUNBURST and SUPERNOVA backdoor hashes",
                "description": "Identifies SolarWinds SUNBURST and SUPERNOVA backdoor file hash IOCs in DeviceFileEvents\nReferences:\n- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html\n- https://gist.github.com/olafhartong/71ffdd4cab4b6acd5cbcd1a0691ff82f",
                "severity": "High",
                "enabled": true,
                "query": "let SunburstMD5=dynamic([\"b91ce2fa41029f6955bff20079468448\",\"02af7cec58b9a5da1c542b5a32151ba1\",\"2c4a910a1299cdae2a4e55988a2f102e\",\"846e27a652a5e1bfbd0ddd38a16dc865\",\"4f2eb62fa529c0283b28d05ddd311fae\"]);\nlet SupernovaMD5=\"56ceb6d0011d87b6e4d7023d7ef85676\";\nDeviceFileEvents\n| where MD5 in(SunburstMD5) or MD5 in(SupernovaMD5)\n| extend\n    timestamp = TimeGenerated,\n    AccountCustomEntity = iff(isnotempty(InitiatingProcessAccountUpn), InitiatingProcessAccountUpn, InitiatingProcessAccountName),\n    HostCustomEntity = DeviceName,\n    FileHashCustomEntity = MD5",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution",
                    "Persistence"
                ],
                "alertRuleTemplateName": "a3c144f9-8051-47d4-ac29-ffb0c312c910",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "InitiatingProcessAccountUpn"
                            },
                            {
                                "identifier": "AadUserId",
                                "columnName": "InitiatingProcessAccountSid"
                            },
                            {
                                "identifier": "DisplayName",
                                "columnName": "RequestAccountName"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "DeviceName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "FolderPath"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "HostCustomEntity"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "InitiatingProcessId"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "InitiatingProcessTokenElevation"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "FileOriginReferrerUrl"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Directory",
                                "columnName": "FolderPath"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "InitiatingProcessParentFileName"
                            }
                        ]
                    },
                    {
                        "entityType": "FileHash",
                        "fieldMappings": [
                            {
                                "identifier": "Value",
                                "columnName": "MD5"
                            },
                            {
                                "identifier": "Algorithm",
                                "columnName": "InitiatingProcessMD5"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/a413966f-37e1-45aa-94ed-dbf1a6be3d01')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/a413966f-37e1-45aa-94ed-dbf1a6be3d01')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Suspicious File Extension  Found in O365 App (SOC Prime)",
                "description": "This rule will trigger when the suspicious file extension is uploaded, downloaded or accessed by the adversary. The suspicious files are the ones that are not used by the normal users on the daily basis. The adversary can get access by installing or changing the different extension to bypass the O365 apps.\n\nAn adversary may rely upon specific actions by a user to gain execution. Users may be subjected to social engineering to get them to execute malicious code by, for example, opening a malicious document file or link. This rule detects file extensions that are potentially dangerous on windows. Technique: T1204.",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"FileUploaded\" or Operation == \"FileAccessed\" or Operation == \"FileDownloaded\") and (SourceFileExtension == \"ade\" or SourceFileExtension == \"adp\" or SourceFileExtension == \"app\" or SourceFileExtension == \"asp\" or SourceFileExtension == \"bas\" or SourceFileExtension == \"bat\" or SourceFileExtension == \"cer\" or SourceFileExtension == \"chm\" or SourceFileExtension == \"cla\" or SourceFileExtension == \"class\" or SourceFileExtension == \"cmd\" or SourceFileExtension == \"cnt\" or SourceFileExtension == \"com\" or SourceFileExtension == \"cpl\" or SourceFileExtension == \"crt\" or SourceFileExtension == \"csh\" or SourceFileExtension == \"der\" or SourceFileExtension == \"diagcab\" or SourceFileExtension == \"exe\" or SourceFileExtension == \"fxp\" or SourceFileExtension == \"gadget\" or SourceFileExtension == \"grp\" or SourceFileExtension == \"hlp\" or SourceFileExtension == \"hpj\" or SourceFileExtension == \"hta\" or SourceFileExtension == \"ins\" or SourceFileExtension == \"isp\" or SourceFileExtension == \"its\" or SourceFileExtension == \"jar\" or SourceFileExtension == \"jnlp\" or SourceFileExtension == \"jse\" or SourceFileExtension == \"ksh\" or SourceFileExtension == \"mad\" or SourceFileExtension == \"maf\" or SourceFileExtension == \"mag\" or SourceFileExtension == \"mam\" or SourceFileExtension == \"maq\" or SourceFileExtension == \"mar\" or SourceFileExtension == \"mas\" or SourceFileExtension == \"mat\" or SourceFileExtension == \"mau\" or SourceFileExtension == \"mav\" or SourceFileExtension == \"maw\" or SourceFileExtension == \"mcf\" or SourceFileExtension == \"mda\" or SourceFileExtension == \"mdb\" or SourceFileExtension == \"mde\" or SourceFileExtension == \"mdt\" or SourceFileExtension == \"mdw\" or SourceFileExtension == \"mdz\" or SourceFileExtension == \"msc\" or SourceFileExtension == \"msh\" or SourceFileExtension == \"msh1\" or SourceFileExtension == \"msh1xml\" or SourceFileExtension == \"msh2\" or SourceFileExtension == \"msh2xml\" or SourceFileExtension == \"mshxml\" or SourceFileExtension == \"msi\" or SourceFileExtension == \"msp\" or SourceFileExtension == \"mst\" or SourceFileExtension == \"msu\" or SourceFileExtension == \"ocx\" or SourceFileExtension == \"ops\" or SourceFileExtension == \"osd\" or SourceFileExtension == \"pcd\" or SourceFileExtension == \"pif\" or SourceFileExtension == \"pl\" or SourceFileExtension == \"plg\" or SourceFileExtension == \"prf\" or SourceFileExtension == \"prg\" or SourceFileExtension == \"ps1\" or SourceFileExtension == \"ps1xml\" or SourceFileExtension == \"ps2\" or SourceFileExtension == \"ps2xml\" or SourceFileExtension == \"psc1\" or SourceFileExtension == \"psc2\" or SourceFileExtension == \"psd1\" or SourceFileExtension == \"psdm1\" or SourceFileExtension == \"pst\" or SourceFileExtension == \"reg\" or SourceFileExtension == \"scf\" or SourceFileExtension == \"scr\" or SourceFileExtension == \"sct\" or SourceFileExtension == \"shb\" or SourceFileExtension == \"shs\" or SourceFileExtension == \"theme\" or SourceFileExtension == \"vb\" or SourceFileExtension == \"vbe\" or SourceFileExtension == \"vbp\" or SourceFileExtension == \"vbs\" or SourceFileExtension == \"vsmacros\" or SourceFileExtension == \"vsw\" or SourceFileExtension == \"webpnp\" or SourceFileExtension == \"website\" or SourceFileExtension == \"ws\" or SourceFileExtension == \"wsc\" or SourceFileExtension == \"wsf\" or SourceFileExtension == \"wsh\" or SourceFileExtension == \"xbap\" or SourceFileExtension == \"xll\" or SourceFileExtension == \"xnk\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadUserId",
                                "columnName": "TargetUserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "InstanceName",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "AppId"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "OfficeId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName_"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "OfficeObjectId"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/93d7fbbb-cd94-48f4-8fec-2d9782e63a15')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/93d7fbbb-cd94-48f4-8fec-2d9782e63a15')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Suspicious O365 Audit Configuration Policy Operations (SOC Prime)",
                "description": "This rule will trigger when it detects the use of Remove-AuditConfigurationPolicy cmdlet to remove audit configuration policies from the Security & Compliance Center. Technique: T1078.",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity | where (Operation == \"Remove-AuditConfigurationPolicy\") | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "IsDomainJoined",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "ObjectGuid",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/b503b298-62dc-45f0-ad39-f8750aae715a')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/b503b298-62dc-45f0-ad39-f8750aae715a')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Suspicious O365 Threat Protection Changes (SOC Prime)",
                "description": "This rule will trigger when one of the Defenders for O365 policies that should always be on has been disabled or removed.\nAdversaries may disable security solutions to avoid possible detection of their activities. Technique: T1078.",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity | where (Operation == \"Disable-AntiPhishRule\" or Operation == \"Disable-SafeAttachmentRule\" or Operation == \"Disable-SafeLinksRule\" or Operation == \"Remove-AntiPhishPolicy\" or Operation == \"Remove-AntiPhishRule\" or Operation == \"Remove-SafeAttachmentPolicy\" or Operation == \"Remove-SafeAttachmentRule\" or Operation == \"Remove-SafeLinksPolicy\" or Operation == \"Remove-SafeLinksRule\") | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution",
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "InstanceName",
                                "columnName": "SourceSystem"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeId"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "Source_Name"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "OfficeObjectId"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "OfficeId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP_"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/1e9d8fe5-1d88-43fe-8128-d072a6ee9696')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/1e9d8fe5-1d88-43fe-8128-d072a6ee9696')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "User Added to an Admin Group in O365 (SOC Prime)",
                "description": "This rule will trigger when adversary will add the user to the admin group in O365 app. \nAn adversary may manipulate the account to maintain access to the victim systems by modifying credentials or permission groups. An adversary will get access to data and settings via the admin role which can also create other accounts for malicious activity.   \nThe rule is triggered when user is added to the admin group in O365 app. \nFor more information, please visit this link: https://attack.mitre.org/techniques/T1098/\n",
                "severity": "High",
                "enabled": true,
                "query": "OfficeActivity \r\n| where ((Operation == \"Add member to group\") and (ResultStatus == \"Success\") and (ModifiedProperties contains \"admin\")) \r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Persistence"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId_"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "OrganizationId_"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "OfficeId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/13bc76db-7367-43f2-8523-e505af061f08')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/13bc76db-7367-43f2-8523-e505af061f08')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": " Abuse Elevation Control Mechanism: SetGID Flag on File in Linux",
                "description": "The rule will trigger when adversary tries to abuse elevation of the group ID on a file in a linux environment.\nAn adversary may perform shell escapes or exploit vulnerabilities in an application with the setsuid or setgid bits to get code running in a different user’s context. On Linux or macOS, when the setuid or setgid bits are set for an application, the application will run with the privileges of the owning user or group respectively.\nReferences: https://attack.mitre.org/techniques/T1548/001/",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"chmod\" and SyslogMessage contains \"g+s\"\r\n| where Facility contains \"authpriv\"\r\n| where Type contains \"Syslog\"\r\n| where SourceSystem contains \"Linux\"\r\n| project SourceSystem, HostIP, HostName, Facility, SyslogMessage, Type, EventTime\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/93223d86-a946-4dcd-8664-8d88bb4bbe4b')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/93223d86-a946-4dcd-8664-8d88bb4bbe4b')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": " Virtualization Evasion: Time Based Evasion in Linux",
                "description": "The rule will trigger when adversary tries to use time based evasion on Linux endpoint like putting a processor to sleep so it will not get detected by the logs.\nAdversaries may employ various time-based methods to detect and avoid virtualization and analysis environments. This may include enumerating time-based properties, such as uptime or the system clock, as well as the use of timers or other triggers to avoid a virtual machine environment (VME) or sandbox, specifically those that are automated or only operate for a limited amount of time.\nReferences: https://attack.mitre.org/techniques/T1497/003/",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"sleep\"\r\n| where Facility contains \"authpriv\" and SourceSystem contains \"Linux\"\r\n| where ProcessName contains \"sudo\"\r\n| project HostName, SyslogMessage, EventTime,HostIP,Type, ProcessName , Facility, SourceSystem\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/a55eaed0-3337-4e6d-87d8-5d0557b544b7')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/a55eaed0-3337-4e6d-87d8-5d0557b544b7')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Abuse Elevation Control Mechanism: SetUID in Linux",
                "description": "The rule will trigger when adversary tries to abuse elevation of the UID like (if the program’s owner is root, then when anyone runs this program, the program gains the root’s privileges during its execution)  on Linux endpoint.\nAn adversary may perform shell escapes or exploit vulnerabilities in an application with the setsuid or setgid bits to get code running in a different user’s context. On Linux or macOS, when the setuid or setgid bits are set for an application, the application will run with the privileges of the owning user or group respectively.\n References: https://attack.mitre.org/techniques/T1548/001/ , https://web.ecs.syr.edu/~wedu/seed/Labs_12.04/Software/Set-UID/Set-UID.pdf",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"setcap\" and SyslogMessage contains \"cap_setuid=ep\"\r\n| where SourceSystem == \"Linux\"\r\n| where Facility contains \"authpriv\"\r\n| where Type == \"Syslog\"\r\n| project SourceSystem, HostIP, HostName,Facility, SyslogMessage, Type, EventTime\r\n| where ingestion_time() >= ago(12h)\r\n",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "DefenseEvasion",
                    "PrivilegeEscalation"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/774ca117-a61e-4b3f-a7da-2941357e6eb3')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/774ca117-a61e-4b3f-a7da-2941357e6eb3')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Anonymizer Tools Detected in O365 Apps (SOC Prime)",
                "description": "The anonymizer tools violate the organization’s policies. The adversary can share and exfiltrate the user/company’s data by establishing a VPN tunnel. It is also possible that it may expose to the external threat. The rule will trigger when the adversary installed the anonymous proxy tool in the O365 app and trying to cover their footprints.\nAn anonymizer or an anonymous proxy is a tool that attempts to make activity on the Internet untraceable. Technique: T1204.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"FileUploaded\" or Operation == \"FileAccessed\" or Operation == \"FileDownloaded\") and (SourceFileName contains \"tbear\" or SourceFileName contains \"i2p\" or SourceFileName contains \"torbrowser\" or SourceFileName contains \"tor.exe\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "UserId_"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName_"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl_"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/98910dcc-41fd-478a-aea2-d8a98d83e95f')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/98910dcc-41fd-478a-aea2-d8a98d83e95f')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Anonymous Link Operations in O365 Apps (SOC Prime)",
                "description": "The rule will trigger when it identifies that the adversary Create, Update and other anonymous link operations detected. Technique: T1074.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where (Operation == \"AnonymousLinkUsed\" or Operation == \"AnonymousLinkUpdated\" or Operation == \"AnonymousLinkCreated\" or Operation == \"AnonymousLinkRemoved\") | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Collection"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/6b0e19b3-1c5f-42d3-b01f-c3a3fc546f8b')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/6b0e19b3-1c5f-42d3-b01f-c3a3fc546f8b')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Azure AD Failed Logins",
                "description": "This rule detects failed logins from Azure Active Directory Sign-ins logs. Please note that the Azure AD Premium license is required to access the Azure AD Sign-ins.",
                "severity": "Medium",
                "enabled": true,
                "query": "SigninLogs \r\n| where AppDisplayName == \"Azure Portal\"\r\n| where ResultType == 50126 | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "InitialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "Identity"
                            },
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserPrincipalName"
                            },
                            {
                                "identifier": "IsDomainJoined",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ResultType"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Category"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultDescription"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "IPAddress"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "AppDisplayName"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "AADTenantId"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "TokenIssuerType"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "DeviceDetail"
                            },
                            {
                                "identifier": "AzureID",
                                "columnName": "ResourceTenantId"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "ClientAppUsed"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/e02c4503-e239-4f67-b825-9f3086725836')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/e02c4503-e239-4f67-b825-9f3086725836')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Brute force attack against Azure Portal",
                "description": "Identifies evidence of brute force activity against Azure Portal by highlighting multiple authentication failures \nand by a successful authentication within a given time window. \n(The query does not enforce any sequence - eg requiring the successful authentication to occur last.)\nDefault Failure count is 20, Default Success count is 1 and default Time Window is 20 minutes.\nReferences: https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes.",
                "severity": "Medium",
                "enabled": true,
                "query": "let failureCountThreshold = 20;\nlet successCountThreshold = 1;\nlet authenticationWindow = 20m;\nlet aadFunc = (tableName:string){\ntable(tableName)\n| extend DeviceDetail = todynamic(DeviceDetail), Status = todynamic(DeviceDetail), LocationDetails = todynamic(LocationDetails)\n| extend OS = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser\n| extend StatusCode = tostring(Status.errorCode), StatusDetails = tostring(Status.additionalDetails)\n| extend State = tostring(LocationDetails.state), City = tostring(LocationDetails.city), Region = tostring(LocationDetails.countryOrRegion)\n| where AppDisplayName has \"Azure Portal\"\n// Split out failure versus non-failure types\n| extend FailureOrSuccess = iff(ResultType in (\"0\", \"50125\", \"50140\", \"70043\", \"70044\"), \"Success\", \"Failure\")\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), IPAddress = make_set(IPAddress), make_set(OS), make_set(Browser), make_set(City),\nmake_set(State), make_set(Region),make_set(ResultType), FailureCount = countif(FailureOrSuccess==\"Failure\"), SuccessCount = countif(FailureOrSuccess==\"Success\") \nby bin(TimeGenerated, authenticationWindow), UserDisplayName, UserPrincipalName, AppDisplayName, Type\n| where FailureCount >= failureCountThreshold and SuccessCount >= successCountThreshold\n| mvexpand IPAddress\n| extend IPAddress = tostring(IPAddress)\n| extend timestamp = StartTime, AccountCustomEntity = UserPrincipalName, IPCustomEntity = IPAddress \n};\nlet aadSignin = aadFunc(\"SigninLogs\");\nlet aadNonInt = aadFunc(\"AADNonInteractiveUserSignInLogs\");\nunion isfuzzy=true aadSignin, aadNonInt",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": "28b42356-45af-40a6-a0b4-a554cdfd5d8a",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserPrincipalName"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "UserDisplayName"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "IPAddress"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "set_OS"
                            },
                            {
                                "identifier": "OSVersion",
                                "columnName": "set_Browser"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "AppDisplayName"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Type"
                            }
                        ]
                    },
                    {
                        "entityType": "RegistryValue",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "set_Region"
                            },
                            {
                                "identifier": "Value",
                                "columnName": "set_City"
                            },
                            {
                                "identifier": "ValueType",
                                "columnName": "set_State"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/23e0a818-2ef8-408b-b90e-12ed44824b00')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/23e0a818-2ef8-408b-b90e-12ed44824b00')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Built-In Account Enabled Unexpectedly",
                "description": "Detects built-in accounts being enabled on Windows devices by using event IDs and built-in account names.",
                "severity": "Medium",
                "enabled": true,
                "query": "SecurityEvent | where EventID == \"4722\" | where TargetUserName == \"Guest\" or TargetUserName == \"Administrator\" | where ingestion_time() >= ago(30min)",
                "queryFrequency": "PT30M",
                "queryPeriod": "PT35M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "tactics": [
                    "Persistence"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "AadUserId",
                                "columnName": "Account"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "AccountDomain"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "AccountType"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "AzureID",
                                "columnName": "SourceComputerId"
                            },
                            {
                                "identifier": "IsDomainJoined",
                                "columnName": "ManagementGroupName"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "Activity"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "OperationType"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "EventData"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIPAddress"
                            }
                        ]
                    },
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "TargetAccount"
                            },
                            {
                                "identifier": "IsDomainJoined",
                                "columnName": "TargetDomainName"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "TargetInfo"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/6601a1e9-0810-4ff1-8dde-12b30e29ba53')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/6601a1e9-0810-4ff1-8dde-12b30e29ba53')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Deleting Audit Log in Linux ",
                "description": "The rule will trigger when adversary delete the audit logs on linux endpoint.\nAdversaries may clear system logs or audit logs to hide evidence of an intrusion. macOS and Linux both keep track of system or user-initiated actions via system logs. \nReferences: https://attack.mitre.org/techniques/T1070/002/",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"rm -rf\" and SyslogMessage contains \"audit\"\r\n| where ProcessName == \"sudo\"\r\n| where Facility == \"authpriv\"\r\n| where Type contains \"Syslog\"\r\n| project HostName, SyslogMessage, EventTime,HostIP,Type, ProcessName , Facility, SourceSystem\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/4a7866b5-aa57-4b46-9d52-0eafc976c1c9')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/4a7866b5-aa57-4b46-9d52-0eafc976c1c9')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Deleting System Log in Linux",
                "description": "The rule will trigger when adversary delete the system logs on Linux endpoint.\nAdversaries may clear system logs to hide evidence of an intrusion. macOS and Linux both keep track of system or user-initiated actions via system logs. The majority of native system logging is stored under the /var/log/ directory. \nReferences: https://attack.mitre.org/techniques/T1070/002/",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"rm -rf\" and SyslogMessage contains \"system.log\"\r\n| where ProcessName == \"sudo\"\r\n| where Facility == \"authpriv\"\r\n| where Type contains \"Syslog\"\r\n| project HostName, SyslogMessage, EventTime,HostIP, Type, ProcessName , Facility, SourceSystem\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/230f90e4-f219-4cdb-a838-685d73b8dfb8')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/230f90e4-f219-4cdb-a838-685d73b8dfb8')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Disabling Syslog in Linux",
                "description": "The rule will trigger when adversary disable the syslog in Linux environment. \nAdversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.\nReferences: https://attack.mitre.org/techniques/T1562/001/",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"systemctl\"\r\n| where SyslogMessage contains \"rsyslog\"\r\n| where Facility contains \"authpriv\"\r\n| where SyslogMessage contains \"stop\"\r\n| where ProcessName == \"sudo\" and Type contains \"syslog\"\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f5299275-8246-49c4-95d7-598d20caa409')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f5299275-8246-49c4-95d7-598d20caa409')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Distribution Group Operations in an O365 App (SOC Prime)",
                "description": "This rule is triggered when the creation, updating, or deletion of DistributionGroup or UnifiedGroup occurred in the organization.\nDistributionGroups can be used only to distribute messages or can be used to distribute messages and to grant access permissions to resources.\nUnified Groups, or better known as Office365 Groups, the security principle that underlies modern SharePoint team sites, Teams, Outlook Groups, Planner, etc. is a very powerful management construct that is the glue that holds the Office 365 security pyramid together. \n Technique: T1098.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity \r\n// Addition of another operation in the query is for UnifiedGroup\r\n| where (Operation contains \"DistributionGroup\") or (Operation contains \"UnifiedGroup\")\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Persistence"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "RecordType"
                            },
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "Parameters"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "OfficeObjectId"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP_"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/abf0f9c6-cf9e-457d-96a3-7c363f9f7202')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/abf0f9c6-cf9e-457d-96a3-7c363f9f7202')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Event Triggered Execution - Emond in Linux",
                "description": "The rule will trigger when changes are made in emond directory. Emond is a Launch Daemon that accepts events from various services, runs them through a simple rules engine, and takes action.\nAdversaries may gain persistence and elevate privileges by executing malicious content triggered by the Event Monitor Daemon (emond). Emond is a Launch Daemon that accepts events from various services, runs them through a simple rules engine, and takes action.\nReferences: https://attack.mitre.org/techniques/T1546/014/",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"/etc/emond.d/rules/\" or SyslogMessage contains \"/private/var/db/emondClients/\"\r\n| where SourceSystem == \"Linux\"\r\n| where Type == \"Syslog\"\r\n| where Facility contains \"authpriv\"\r\n| project SourceSystem, HostIP, HostName, Facility, SyslogMessage, Type, EventTime\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "PrivilegeEscalation",
                    "Persistence"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/cc580133-24d0-4b50-bd9a-0ab3dff2e1b3')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/cc580133-24d0-4b50-bd9a-0ab3dff2e1b3')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "High Count of Failed Logons By User",
                "description": "Identifies when 20 or more failed attempts by a given user in 20 minutes occur on the IIS Server.\nThis could be indicative of attempted brute force based on known account information.\nThis could also simply indicate a misconfigured service or device. \nReferences:\nIIS status code mapping - https://support.microsoft.com/help/943891/the-http-status-code-in-iis-7-0-iis-7-5-and-iis-8-0\nWin32 Status code mapping - https://msdn.microsoft.com/library/cc231199.aspx",
                "severity": "Medium",
                "enabled": true,
                "query": "\n  let failureCountThreshold = 20;\n  let successCountThreshold = 0;\n  let authenticationWindow = 20m;\n  let aadFunc = (tableName:string){\n  table(tableName)\n  | extend DeviceDetail = todynamic(DeviceDetail), Status = todynamic(DeviceDetail), LocationDetails = todynamic(LocationDetails)\n  | extend OS = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser\n  | extend StatusCode = tostring(Status.errorCode), StatusDetails = tostring(Status.additionalDetails)\n  | extend State = tostring(LocationDetails.state), City = tostring(LocationDetails.city), Region = tostring(LocationDetails.countryOrRegion)\n  | where AppDisplayName has \"Azure Portal\"\n  // Split out failure versus non-failure types\n  | extend FailureOrSuccess = iff(ResultType in (\"0\", \"50125\", \"50140\", \"70043\", \"70044\"), \"Success\", \"Failure\")\n  | summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), IPAddress = make_set(IPAddress), make_set(OS), make_set(Browser), make_set(City),\n  make_set(State), make_set(Region),make_set(ResultType), FailureCount = countif(FailureOrSuccess==\"Failure\"), SuccessCount = countif(FailureOrSuccess==\"Success\") \n  by bin(TimeGenerated, authenticationWindow), UserDisplayName, UserPrincipalName, AppDisplayName, Type\n  | where FailureCount >= failureCountThreshold and SuccessCount >= successCountThreshold\n  | mvexpand IPAddress\n  | extend IPAddress = tostring(IPAddress)\n  | extend timestamp = StartTime, AccountCustomEntity = UserPrincipalName, IPCustomEntity = IPAddress \n  };\n  let aadSignin = aadFunc(\"SigninLogs\");\n  let aadNonInt = aadFunc(\"AADNonInteractiveUserSignInLogs\");\n  union isfuzzy=true aadSignin, aadNonInt",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": "884c4957-70ea-4f57-80b9-1bca3890315b",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserPrincipalName"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserDisplayName"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "AppDisplayName"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "Type"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "IPAddress"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "set_OS"
                            },
                            {
                                "identifier": "OSVersion",
                                "columnName": "set_Browser"
                            },
                            {
                                "identifier": "IsDomainJoined",
                                "columnName": "set_Region"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f02de86f-3427-44b7-8843-b9acf500f438')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f02de86f-3427-44b7-8843-b9acf500f438')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Hijack Execution Flow: Dynamic Linker Hijacking in Linux",
                "description": "This rule will trigger when hijack execution flow activity is detected by the changes made in the linker directory. \nAn execution flow hijack attempt incident indicates that a possible attempt to hijack a program execution flow was observed. Special Linux library system files, which have a system-wide effect, were altered (this is usually undesirable, and is typically employed only as an emergency remedy or maliciously).\nAdversaries may execute their own malicious payloads by hijacking environment variables the dynamic linker uses to load shared libraries. During the execution preparation phase of a program, the dynamic linker loads specified absolute paths of shared libraries from environment variables and files, such as LD_PRELOAD on Linux or DYLD_INSERT_LIBRARIES on macOS.\nReferences https://attack.mitre.org/techniques/T1574/006/ , https://docs.paloaltonetworks.com/content/techdocs/en_US/prisma/prisma-cloud/prisma-cloud-admin-compute/runtime_defense/incident_types/execution_flow_hijack_attempt.html#:~:text=An%20execution%20flow%20hijack%20attempt%20incident%20indicates%20that,employed%20only%20as%20an%20emergency%20remedy%20or%20maliciously%29.",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog\r\n| where SyslogMessage contains \"/etc/ld.so.preload\" or SyslogMessage contains \"LD_PRELOAD\"\r\n| where Facility contains \"authpriv\"\r\n| where Type contains \"Syslog\"\r\n| where SourceSystem contains \"Linux\"\r\n| project SourceSystem, HostIP, HostName,Facility, SyslogMessage, Type, EventTime\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Persistence",
                    "PrivilegeEscalation",
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Type"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/c8aba2ad-28fa-45c3-939b-be3a631fae41')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/c8aba2ad-28fa-45c3-939b-be3a631fae41')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Malware Detected by SharePoint AV Engine (SOC Prime)",
                "description": "This rule will trigger when SharePoint online AV engine detects any malware file on the SharePoint that has the known bad reputation or contains the compromised IOC’s in it.\nOffice 365 uses a common virus detection engine. The engine runs asynchronously within SharePoint Online, and scans files after they're uploaded. When a file is found to contain a virus, it's flagged so that it can't be downloaded again. Technique: T1204.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where (Operation == \"FileMalwareDetected\") | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeId"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/2db32edd-3645-4ca2-9435-7a904002745a')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/2db32edd-3645-4ca2-9435-7a904002745a')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "O365 App Established a Connection With a Suspicious User Agent (SOC Prime)",
                "description": "This rule will trigger when it identifies direct download via Powershell or other tools. Technique: T1105,T1105.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where (UserAgent contains \"Wget\" or UserAgent contains \"curl\" or UserAgent contains \"PowerShell\" or UserAgent contains \"WinRM\" or UserAgent contains \"Bits\") | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CommandAndControl",
                    "LateralMovement"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "AadUserId",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/37eb4d1b-8877-4429-adcf-841dc1909ce5')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/37eb4d1b-8877-4429-adcf-841dc1909ce5')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "O365 Data Loss Prevention Rule Match (SOC Prime)",
                "description": "The Data Loss prevention (DLP) helps to prevent the accidental or unintentionally sharing of sensitive information by email or file sharing. The DLP rule is configured in M 365 Compliance. \nThe rule is triggered when the email or file contains sensitive information which matches the DLP policy. These events exist in both Exchange and SharePoint Online and OneDrive for Business. For more information, please visit this link: https://attack.mitre.org/techniques/T1114/\n",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity \r\n| where (Operation == \"DLPRuleMatch\") \r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Collection"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/c1a0fb01-d4fe-42e0-89f6-c83f2bebfc3f')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/c1a0fb01-d4fe-42e0-89f6-c83f2bebfc3f')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "O365 Data Loss Prevention Undo Action (SOC Prime)",
                "description": "This alert is triggered due to Sharepoint  and OneDrive policy undo. These only exist in SharePoint Online and OneDrive for Business.  They indicate a previously applied policy action has been \"undone\" –  either because of false-positive/override designation by the user or because the document is noclonger subject to policy, due to policy change or change in the document content.\nTechnique: T1078.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where (Operation == \"DLPRuleUndo\") | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "AadUserId",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "IsDomainJoined",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "ObjectGuid",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/8dbd0b5a-319f-4324-9787-3f8651070bba')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/8dbd0b5a-319f-4324-9787-3f8651070bba')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "O365 Sharing Policy was Changed (SOC Prime)",
                "description": "The rule will trigger when it detects the adversary may be manipulating the account to maintain access to the victim systems by modifying credentials or permission groups.\nThe rule is triggered when a SharePoint or global administrator changed a SharePoint sharing policy by using the Office 365 admin portal, SharePoint admin portal, or SharePoint Online Management Shell. For more information, please visit this link: https://attack.mitre.org/techniques/T1098/",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity \r\n| where (Operation == \"SharingPolicyChanged\") \r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "UserId_"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "OrganizationId_"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "SourceRelativeUrl_"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "OfficeId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/e9829f5e-fbbe-43ad-836f-5b1ee6b033dc')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/e9829f5e-fbbe-43ad-836f-5b1ee6b033dc')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "RDP Brute Force Enumeration or Scan (SOC Prime)",
                "description": "Adversary attempts to gain access to Windows systems and execute malware by brute-forcing RDP (Remote Desktop Protocol). They use tools on exposed RDP ports to enumerate or scan the online systems. \nThe rule will trigger when adversary tries to login with wrong/ non-existing username or with correct username but wrong password using RDP. \nFor more information, please visit this link: https://attack.mitre.org/techniques/T1021/\n",
                "severity": "Medium",
                "enabled": true,
                "query": "SecurityEvent\r\n| where EventID == \"4625\"\r\n// 0xC0000064 =\tUser logon with misspelled or bad user account\r\n// 0xC000006A =\tUser logon with misspelled or bad password\r\n| where (SubStatus == \"0xc000006A\" or SubStatus == \"0xc0000064\") \r\n//| project TimeGenerated, EventID, WorkstationName, Computer, Account, LogonTypeName, LogonType, LogonProcessName, SubStatus, Activity\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "TargetAccount"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "TargetUserName"
                            },
                            {
                                "identifier": "IsDomainJoined",
                                "columnName": "DomainName"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "AccountType"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "WorkstationName"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "Activity"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "LogonProcessName"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "SubStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "AzureResource",
                        "fieldMappings": [
                            {
                                "identifier": "ResourceId",
                                "columnName": "_ResourceId"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIPAddress"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/da1d101f-7ad0-46b0-a1c6-269025060c61')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/da1d101f-7ad0-46b0-a1c6-269025060c61')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Reset User Password Operation in O365 (SOC Prime)",
                "description": "The rule will trigger when adversary tries to perform password reset action was performed. Technique: T1098.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"Reset user password\") and (ResultStatus == \"Failure\" or ResultStatus == \"Success\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/292a0658-7c81-4519-98aa-2c3eee9b4e05')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/292a0658-7c81-4519-98aa-2c3eee9b4e05')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Security Event log cleared",
                "description": "The adversary may clear Windows Event Logs to hide the malicious activity. These actions may interfere with event collection, reporting and other notifications used to detect intrusion activity.\nThe rule is triggered when Windows Security event logs are removed/cleared. The rule checks for Event ID 1102 which indicates the security event log was cleared. It also uses Event Source Name \"Microsoft-Windows-Eventlog\" to avoid generating false positives from other sources, like AD FS servers for instance. For more information, please visit this link: https://attack.mitre.org/techniques/T1070/\n\n",
                "severity": "Medium",
                "enabled": true,
                "query": "SecurityEvent\n| where EventID == 1102 and EventSourceName == \"Microsoft-Windows-Eventlog\" \n//| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), EventCount = count() by Computer, Account, EventID, Activity\n//| extend timestamp = StartTimeUtc, AccountCustomEntity = Account, HostCustomEntity = Computer",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "DefenseEvasion"
                ],
                "alertRuleTemplateName": "80da0a8f-cfe1-4cd0-a895-8bc1771a720e",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserPrincipalName"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "AccountDomain"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "SourceComputerId"
                            },
                            {
                                "identifier": "AzureID",
                                "columnName": "Activity"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "ManagementGroupName"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "CommandLine",
                                "columnName": "EventSourceName"
                            },
                            {
                                "identifier": "ProcessId",
                                "columnName": "Activity"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "TokenElevationType"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/5deaa448-ae06-4ef6-921e-07b9caa83351')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/5deaa448-ae06-4ef6-921e-07b9caa83351')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Sensitive File Operations in an O365 App (SOC Prime)",
                "description": "This rule will trigger when it detects the uploading, downloading or copying of the sensitive files, which contains sensitive information on the O365 apps. The rule is based on the words within the documents if they contains the sensitive names within the document like password, secrets, etc. \nTechnique: T1074.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"FileUploaded\" or Operation == \"FileDownloaded\" or Operation == \"FileCopied\") and (OfficeObjectId contains \"passwo\" or OfficeObjectId contains \"confide\" or OfficeObjectId contains \"secret\" or OfficeObjectId contains \"finance\" or OfficeObjectId contains \"Cash\" or OfficeObjectId contains \"banking\" or OfficeObjectId contains \"swift\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Collection"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "UserAgent"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "OfficeId"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "OfficeObjectId"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeId"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/8e7a3ec0-f84d-4935-9735-4134cab9d23d')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/8e7a3ec0-f84d-4935-9735-4134cab9d23d')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Sensitive File Sharing in O365 Apps (SOC Prime)",
                "description": "This rule will trigger when it detects the creation of sharing links that contains the possible sensitive information in it. The rule detects the sensitive words like secret, password, banking.  Technique: T1074.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where ((Operation == \"SharingInheritanceBroken\" or Operation == \"SharingSet\" or Operation == \"SecureLinkCreated\" or Operation == \"SecureLinkUsed\") and (OfficeObjectId contains \"passwo\" or OfficeObjectId contains \"confide\" or OfficeObjectId contains \"secret\" or OfficeObjectId contains \"finance\" or OfficeObjectId contains \"Cash\" or OfficeObjectId contains \"banking\" or OfficeObjectId contains \"swift\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Collection"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            },
                            {
                                "identifier": "FullName",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "SourceSystem"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "OfficeId"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "OfficeObjectId"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/f1f9b0b4-f369-4e6c-b3a7-bf93bac7b569')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/f1f9b0b4-f369-4e6c-b3a7-bf93bac7b569')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "Set DirSyncEnabled Flag in an O365 App(SOC Prime)",
                "description": "The rule will trigger when it detects that the value of DirSyncEnabled attribute defines if its a cloud only account or synced account. A synched account can be used for data exfiltration. Technique: T1020.",
                "severity": "Medium",
                "enabled": true,
                "query": "OfficeActivity | where ((ResultStatus == \"Success\") and (ModifiedProperties contains \"DirSyncEnabled\")) | where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Exfiltration"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "UPNSuffix",
                                "columnName": "UserId"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "OrganizationId"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "UserType"
                            }
                        ]
                    },
                    {
                        "entityType": "CloudApplication",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "OfficeWorkload"
                            },
                            {
                                "identifier": "InstanceName",
                                "columnName": "OfficeObjectId"
                            },
                            {
                                "identifier": "AppId",
                                "columnName": "Site_Url"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SourceFileName"
                            },
                            {
                                "identifier": "Directory",
                                "columnName": "ItemType"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "EventSource"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "Operation"
                            },
                            {
                                "identifier": "ElevationToken",
                                "columnName": "ResultStatus"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "ClientIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/1f98750a-4ddb-4d2d-a5a7-6d5fbea2b5fd')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/1f98750a-4ddb-4d2d-a5a7-6d5fbea2b5fd')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "SSH Brute Force Detected in Linux",
                "description": "The rule triggered when SSH failed login attempts are detected in Linux environment. \nAdversaries may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained. Without knowledge of the password for an account or set of accounts, an adversary may systematically guess the password using a repetitive or iterative mechanism. Brute forcing passwords can take place via interaction with a service that will check the validity of those credentials or offline against previously acquired credential data, such as password hashes.",
                "severity": "Medium",
                "enabled": true,
                "query": "Syslog | where * contains 'failure'\r\n| where ProcessName contains 'sshd'\r\n| where ingestion_time() >= ago(12h)",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": [
                    "CredentialAccess"
                ],
                "alertRuleTemplateName": null,
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "Name",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "HostName"
                            },
                            {
                                "identifier": "HostName",
                                "columnName": "Computer"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "SourceSystem"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "ProcessID"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "SyslogMessage"
                            }
                        ]
                    },
                    {
                        "entityType": "IP",
                        "fieldMappings": [
                            {
                                "identifier": "Address",
                                "columnName": "HostIP"
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/6af67656-0e66-40a3-9346-1f0b396f1c9d')]",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/6af67656-0e66-40a3-9346-1f0b396f1c9d')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-09-01-preview",
            "properties": {
                "displayName": "SUNBURST network beacons",
                "description": "This rule will triggered when it identifies SolarWinds SUNBURST domain beacon IOCs in DeviceNetworkEvents\nReferences:\n- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html\n- https://gist.github.com/olafhartong/71ffdd4cab4b6acd5cbcd1a0691ff82f",
                "severity": "Medium",
                "enabled": true,
                "query": "let SunburstURL=dynamic([\"panhardware.com\",\"databasegalore.com\",\"avsvmcloud.com\",\"freescanonline.com\",\"thedoccloud.com\",\"deftsecurity.com\"]);\nDeviceNetworkEvents\n| where ActionType == \"ConnectionSuccess\"\n| where RemoteUrl in(SunburstURL)\n| extend\n    timestamp = TimeGenerated,\n    AccountCustomEntity = iff(isnotempty(InitiatingProcessAccountUpn), InitiatingProcessAccountUpn, InitiatingProcessAccountName),\n    HostCustomEntity = DeviceName,\n    FileHashCustomEntity = InitiatingProcessMD5, \n    HashAlgorithm = 'MD5',\n    URLCustomEntity = RemoteUrl,\n    IPCustomEntity = RemoteIP",
                "queryFrequency": "PT12H",
                "queryPeriod": "PT12H10M",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT12H",
                "suppressionEnabled": true,
                "tactics": [
                    "Execution",
                    "Persistence"
                ],
                "alertRuleTemplateName": "ce1e7025-866c-41f3-9b08-ec170e05e73e",
                "incidentConfiguration": {
                    "createIncident": true,
                    "groupingConfiguration": {
                        "enabled": false,
                        "reopenClosedIncident": false,
                        "lookbackDuration": "PT5H",
                        "matchingMethod": "AllEntities",
                        "groupByEntities": [],
                        "groupByAlertDetails": [],
                        "groupByCustomDetails": []
                    }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": null,
                "customDetails": null,
                "entityMappings": [
                    {
                        "entityType": "Account",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "InitiatingProcessAccountName"
                            },
                            {
                                "identifier": "DisplayName",
                                "columnName": "InitiatingProcessAccountUpn"
                            },
                            {
                                "identifier": "AadTenantId",
                                "columnName": "TenantId"
                            }
                        ]
                    },
                    {
                        "entityType": "Host",
                        "fieldMappings": [
                            {
                                "identifier": "FullName",
                                "columnName": "DeviceName"
                            },
                            {
                                "identifier": "OSFamily",
                                "columnName": "InitiatingProcessFileName"
                            },
                            {
                                "identifier": "OSVersion",
                                "columnName": "InitiatingProcessFolderPath"
                            }
                        ]
                    },
                    {
                        "entityType": "File",
                        "fieldMappings": [
                            {
                                "identifier": "Directory",
                                "columnName": "RemoteUrl"
                            },
                            {
                                "identifier": "Name",
                                "columnName": "RemoteIP"
                            }
                        ]
                    },
                    {
                        "entityType": "Process",
                        "fieldMappings": [
                            {
                                "identifier": "ProcessId",
                                "columnName": "InitiatingProcessFileName"
                            },
                            {
                                "identifier": "CommandLine",
                                "columnName": "InitiatingProcessCommandLine"
                            },
                            {
                                "identifier": "CreationTimeUtc",
                                "columnName": "TimeGenerated"
                            }
                        ]
                    },
                    {
                        "entityType": "FileHash",
                        "fieldMappings": [
                            {
                                "identifier": "Algorithm",
                                "columnName": "HashAlgorithm"
                            },
                            {
                                "identifier": "Value",
                                "columnName": "FileHashCustomEntity"
                            }
                        ]
                    }
                ]
            }
        }
    ]
}